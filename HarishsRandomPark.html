<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Random Park Books - Buy Books with Tickets</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            .login-btn {
                padding: 12px 16px;
                font-size: 14px;
                gap: 8px;
            }
            
            .login-btn svg {
                width: 18px;
                height: 18px;
            }
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        header {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        .logo {
            font-size: 32px;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .header-right {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        .stats-panel {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .stat-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 10px 15px;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .ticket-counter {
            display: flex;
            align-items: center;
            gap: 10px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            padding: 12px 24px;
            border-radius: 25px;
            color: white;
            font-weight: bold;
            font-size: 18px;
            box-shadow: 0 4px 15px rgba(245, 87, 108, 0.4);
            cursor: pointer;
            transition: all 0.3s;
        }
        .ticket-counter:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(245, 87, 108, 0.6);
        }
        .customize-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        .customize-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }
        .banner {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            padding: 20px;
            border-radius: 15px;
            color: white;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        .filters-section {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        .filters {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }
        .filter-btn {
            padding: 10px 20px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        .filter-btn.active {
            background: #667eea;
            color: white;
        }
        .search-box {
            padding: 10px 15px;
            border: 2px solid #ddd;
            border-radius: 20px;
            font-size: 14px;
            flex: 1;
            min-width: 200px;
        }
        .books-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        .book-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
            position: relative;
        }
        .book-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.2);
        }
        .book-card.discounted::before {
            content: 'üî• HOT DEAL';
            position: absolute;
            top: -10px;
            right: 10px;
            background: #f5576c;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: bold;
        }
        .book-rating {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
        }
        .book-title {
            font-size: 20px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            line-height: 1.4;
        }
        .book-meta {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            font-size: 12px;
            color: #666;
        }
        .book-prices {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        .price-option {
            flex: 1;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
        }
        .price-label {
            font-size: 12px;
            opacity: 0.9;
            margin-bottom: 5px;
        }
        .price-value {
            font-size: 18px;
        }
        .buy-buttons {
            display: flex;
            gap: 10px;
        }
        .buy-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }
        .buy-ebook {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .buy-physical {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }
        .buy-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        .buy-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        .preview-btn {
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        .preview-btn:hover {
            background: #667eea;
            color: white;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            overflow-y: auto;
        }
        .modal-content {
            background: white;
            max-width: 700px;
            margin: 50px auto;
            padding: 40px;
            border-radius: 15px;
            position: relative;
        }
        .close-btn {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 30px;
            cursor: pointer;
            color: #666;
        }
        .close-btn:hover {
            color: #000;
        }
        .preview-text {
            line-height: 1.8;
            color: #333;
            white-space: pre-wrap;
        }
        .cart-section {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        .cart {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        .cart h3 {
            color: #667eea;
            margin-bottom: 15px;
        }
        .cart-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background: #f8f9fa;
            margin-bottom: 10px;
            border-radius: 8px;
        }
        .cart-summary {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        .checkout-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s;
        }
        .checkout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(67, 233, 123, 0.4);
        }
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            z-index: 2000;
            display: none;
            animation: slideIn 0.3s;
        }
        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        .badge {
            background: #f5576c;
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            margin-left: 8px;
        }
        .welcome-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            z-index: 3000;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .welcome-box {
            background: white;
            padding: 50px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 450px;
            width: 90%;
            text-align: center;
        }
        .welcome-box h1 {
            color: #667eea;
            margin-bottom: 30px;
            font-size: 32px;
        }
        .welcome-box input {
            width: 100%;
            padding: 15px;
            margin-bottom: 20px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            transition: border 0.3s;
            display: none;
        }
        .welcome-box input.show {
            display: block;
        }
        .welcome-box input:focus {
            outline: none;
            border-color: #667eea;
        }
        .login-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
            width: 100%;
        }
        .login-btn {
            width: 100%;
            padding: 14px 20px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            background: white;
            color: #333;
        }
        .login-btn svg {
            flex-shrink: 0;
        }
        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        .google-btn:hover {
            border-color: #4285f4;
            background: #f8fbff;
        }
        .facebook-btn:hover {
            border-color: #1877f2;
            background: #f0f7ff;
        }
        .apple-btn:hover {
            border-color: #000;
            background: #f5f5f5;
        }
        .email-btn:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }
        .admin-section {
            display: none;
        }
        .admin-book-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .admin-btn-delete {
            background: #dc3545;
            padding: 8px 16px;
            border-radius: 6px;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
        }
        .admin-btn-delete:hover {
            background: #c82333;
        }
        .start-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s;
        }
        .start-btn:hover {
            transform: scale(1.05);
        }
        .start-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        .welcome-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }
        .customize-section {
            margin-top: 25px;
            padding-top: 25px;
            border-top: 2px solid #eee;
        }
        .customize-section h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 18px;
        }
        .color-options {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }
        .color-btn {
            width: 100%;
            height: 50px;
            border: 3px solid transparent;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .color-btn:hover {
            transform: scale(1.1);
        }
        .color-btn.selected {
            border-color: #333;
            box-shadow: 0 0 0 2px white, 0 0 0 4px #333;
        }
        .avatar-options {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        .avatar-btn {
            font-size: 35px;
            padding: 8px;
            border: 3px solid transparent;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s;
            background: #f8f9fa;
        }
        .avatar-btn:hover {
            transform: scale(1.2);
        }
        .avatar-btn.selected {
            border-color: #667eea;
            background: #e8eaf6;
        }
        .order-form-container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        .order-form-container h3 {
            color: #667eea;
            margin-bottom: 20px;
            text-align: center;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 14px;
            transition: border 0.3s;
        }
        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }
        @media (max-width: 1200px) {
            .books-grid {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
                gap: 20px;
            }
        }

        @media (max-width: 968px) {
            .container {
                padding: 0 10px;
            }
            
            header {
                flex-direction: column;
                align-items: stretch;
                padding: 20px;
            }
            
            .logo {
                font-size: 28px;
                text-align: center;
                margin-bottom: 15px;
            }
            
            .header-right {
                flex-direction: column;
                align-items: stretch;
            }
            
            .stats-panel {
                justify-content: center;
            }
            
            .ticket-counter {
                width: 100%;
                justify-content: center;
                flex-wrap: wrap;
            }
            
            .customize-btn {
                width: 100%;
            }
            
            .books-grid {
                grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
                gap: 15px;
            }
            
            .cart-section {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .welcome-box {
                padding: 30px 20px;
                width: 95%;
            }
            
            .welcome-box h1 {
                font-size: 24px;
            }
            
            .welcome-icon {
                font-size: 48px;
            }
            
            header {
                padding: 15px;
                margin-bottom: 20px;
            }
            
            .logo {
                font-size: 24px;
            }
            
            .stat-box {
                font-size: 12px;
                padding: 8px 12px;
            }
            
            .ticket-counter {
                font-size: 16px;
                padding: 10px 20px;
            }
            
            .banner {
                padding: 15px;
                margin-bottom: 20px;
            }
            
            .banner h2 {
                font-size: 18px;
            }
            
            .banner p {
                font-size: 14px;
            }
            
            .filters-section {
                padding: 15px;
            }
            
            .filters {
                gap: 10px;
            }
            
            .filter-btn {
                padding: 8px 15px;
                font-size: 13px;
            }
            
            .search-box {
                width: 100%;
                min-width: 100%;
            }
            
            .books-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .book-card {
                padding: 20px;
            }
            
            .book-title {
                font-size: 18px;
            }
            
            .book-prices {
                flex-direction: column;
                gap: 10px;
            }
            
            .buy-buttons {
                flex-direction: column;
                gap: 10px;
            }
            
            .cart, .cart-summary {
                padding: 20px;
            }
            
            .order-form-container {
                padding: 20px;
            }
            
            .modal-content {
                margin: 20px auto;
                padding: 30px 20px;
                width: 95%;
            }
            
            .notification {
                right: 10px;
                left: 10px;
                top: 10px;
            }
        }

        @media (max-width: 480px) {
            .welcome-box {
                padding: 25px 15px;
            }
            
            .welcome-box h1 {
                font-size: 20px;
                margin-bottom: 20px;
            }
            
            .welcome-box input {
                padding: 12px;
                font-size: 14px;
            }
            
            .start-btn {
                padding: 12px;
                font-size: 16px;
            }
            
            .login-buttons {
                gap: 10px;
            }
            
            .login-btn {
                padding: 12px 15px;
                font-size: 14px;
                gap: 8px;
            }
            
            .login-btn svg {
                width: 18px;
                height: 18px;
            }
            
            .logo {
                font-size: 20px;
            }
            
            .stat-box {
                font-size: 11px;
                padding: 6px 10px;
            }
            
            .ticket-counter {
                font-size: 14px;
                padding: 8px 15px;
                gap: 5px;
            }
            
            .banner h2 {
                font-size: 16px;
            }
            
            .banner p {
                font-size: 12px;
            }
            
            .filter-btn {
                padding: 6px 12px;
                font-size: 12px;
            }
            
            .book-card {
                padding: 15px;
            }
            
            .book-title {
                font-size: 16px;
            }
            
            .price-value {
                font-size: 16px;
            }
            
            .buy-btn {
                padding: 10px;
                font-size: 13px;
            }
            
            .preview-btn {
                padding: 8px;
                font-size: 13px;
            }
            
            .cart-item {
                flex-direction: column;
                gap: 5px;
            }
            
            .customize-section h3 {
                font-size: 16px;
            }
            
            .color-options {
                grid-template-columns: repeat(4, 1fr);
                gap: 8px;
            }
            
            .color-btn {
                height: 40px;
            }
            
            .avatar-btn {
                font-size: 28px;
                padding: 5px;
            }
            
            .modal-content {
                padding: 20px 15px;
            }
            
            .close-btn {
                font-size: 24px;
                top: 10px;
                right: 15px;
            }
            
            .order-form-container {
                padding: 15px;
            }
            
            .order-form-container h3 {
                font-size: 18px;
            }
            
            .form-group input,
            .form-group textarea {
                padding: 10px;
                font-size: 14px;
            }
        }

        @media (max-width: 360px) {
            body {
                padding: 5px;
            }
            
            .welcome-box {
                padding: 20px 10px;
            }
            
            .welcome-box h1 {
                font-size: 18px;
            }
            
            .login-btn {
                padding: 10px 12px;
                font-size: 13px;
                gap: 6px;
            }
            
            .login-btn svg {
                width: 16px;
                height: 16px;
            }
            
            .logo {
                font-size: 18px;
            }
            
            .ticket-counter {
                font-size: 12px;
                padding: 6px 12px;
            }
            
            .book-card {
                padding: 12px;
            }
            
            .color-options {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        /* Landscape orientation optimizations */
        @media (max-height: 600px) and (orientation: landscape) {
            .welcome-screen {
                padding: 20px 0;
                overflow-y: auto;
            }
            
            .welcome-box {
                margin: 20px auto;
                max-height: 90vh;
                overflow-y: auto;
            }
            
            .welcome-icon {
                font-size: 40px;
                margin-bottom: 10px;
            }
            
            .welcome-box h1 {
                font-size: 22px;
                margin-bottom: 15px;
            }
            
            .customize-section {
                margin-top: 15px;
                padding-top: 15px;
            }
        }
    </style>
</head>
<body>
    <div id="welcomeScreen" class="welcome-screen">
        <div class="welcome-box">
            <div class="welcome-icon">üìö</div>
            <h1>Welcome to Random Park Books!</h1>
            
            <div class="login-buttons">
                <button class="login-btn google-btn" onclick="loginWithGoogle()">
                    <svg width="20" height="20" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
                        <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
                        <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/>
                        <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
                    </svg>
                    Log In with Google
                </button>
                <button class="login-btn facebook-btn" onclick="loginWithFacebook()">
                    <svg width="20" height="20" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z" fill="#1877F2"/>
                    </svg>
                    Log In with Facebook
                </button>
                <button class="login-btn apple-btn" onclick="loginWithApple()">
                    <svg width="20" height="20" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M17.05 20.28c-.98.95-2.05.8-3.08.35-1.09-.46-2.09-.48-3.24 0-1.44.62-2.2.44-3.06-.35C2.79 15.25 3.51 7.59 9.05 7.31c1.35.07 2.29.74 3.08.8 1.18-.24 2.31-.93 3.57-.84 1.51.12 2.65.72 3.4 1.8-3.12 1.87-2.38 5.98.48 7.13-.57 1.5-1.31 2.99-2.54 4.09l.01-.01zM12.03 7.25c-.15-2.23 1.66-4.07 3.74-4.25.29 2.58-2.34 4.5-3.74 4.25z" fill="#000000"/>
                    </svg>
                    Log In with Apple
                </button>
                <button class="login-btn email-btn" onclick="loginWithEmail()">
                    <svg width="20" height="20" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z" fill="#667eea"/>
                    </svg>
                    Log In with Email
                </button>
            </div>
            
            <div class="customize-section">
                <h3>Choose Your Avatar</h3>
                <div class="avatar-options">
                    <button class="avatar-btn selected" onclick="selectAvatar('üòä')">üòä</button>
                    <button class="avatar-btn" onclick="selectAvatar('üòÉ')">üòÉ</button>
                    <button class="avatar-btn" onclick="selectAvatar('üôÇ')">üôÇ</button>
                    <button class="avatar-btn" onclick="selectAvatar('üòÑ')">üòÑ</button>
                    <button class="avatar-btn" onclick="selectAvatar('üòÅ')">üòÅ</button>
                    <button class="avatar-btn" onclick="selectAvatar('üòÜ')">üòÜ</button>
                </div>
            </div>
            <div class="customize-section">
                <h3>Choose Your Theme Color</h3>
                <div class="color-options">
                    <button class="color-btn selected" onclick="selectColor('purple')" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);"></button>
                    <button class="color-btn" onclick="selectColor('blue')" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);"></button>
                    <button class="color-btn" onclick="selectColor('pink')" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);"></button>
                    <button class="color-btn" onclick="selectColor('green')" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);"></button>
                    <button class="color-btn" onclick="selectColor('orange')" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);"></button>
                    <button class="color-btn" onclick="selectColor('teal')" style="background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);"></button>
                    <button class="color-btn" onclick="selectColor('red')" style="background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);"></button>
                    <button class="color-btn" onclick="selectColor('sunset')" style="background: linear-gradient(135deg, #ff6e7f 0%, #bfe9ff 100%);"></button>
                </div>
            </div>
            <input type="email" id="userEmail" placeholder="Enter your email" style="display: none;" />
            <button class="start-btn" onclick="startApp()" style="display: none;" id="startButton">Start Shopping</button>
        </div>
    </div>
    <div class="container" id="mainApp" style="display: none;">
        <header>
            <div class="logo">üìö Random Park Books</div>
            <div class="header-right">
                <div class="stats-panel">
                    <div class="stat-box">
                        <span>üìä</span>
                        <span>Level <span id="userLevel">1</span></span>
                    </div>
                    <div class="stat-box">
                        <span>üìö</span>
                        <span><span id="booksBadge">0</span> Books</span>
                    </div>
                    <div class="stat-box" onclick="openAdminLogin()" style="cursor: pointer;">
                        <span>üîê</span>
                        <span>Admin</span>
                    </div>
                </div>
                <button class="customize-btn" onclick="openOrderForm()">üìß Order via Email</button>
                <div class="ticket-counter">
                    <span class="ticket-icon">üé´</span>
                    <span id="ticketCount">0</span>
                    <span>Tickets</span>
                    <span style="margin-left: 15px;"><span id="userAvatar">üòä</span> <span id="displayName"></span></span>
                </div>
            </div>
        </header>

        <div class="banner">
            <h2>üéâ National Coffee Day Special! üéâ</h2>
            <p>Get 1 Ticket on any Ebook purchase! ‚Ä¢ Most Popular: Adventures of Maple and the Sky Kingdom üî•</p>
        </div>

        <div class="order-form-container" id="orderFormContainer" style="display: none;">
            <h3>üìß Place Your Order via Email</h3>
            <form id="orderForm" onsubmit="submitOrder(event)">
                <div class="form-group">
                    <label for="orderName">Your Name:</label>
                    <input type="text" id="orderName" required />
                </div>
                <div class="form-group">
                    <label for="orderEmail">Your Email:</label>
                    <input type="email" id="orderEmail" required />
                </div>
                <div class="form-group">
                    <label for="orderDetails">Order Details:</label>
                    <textarea id="orderDetails" placeholder="List the books you want to order (title, type, quantity)..." required></textarea>
                </div>
                <button type="submit" class="checkout-btn">üì® Send Order Request</button>
                <button type="button" class="checkout-btn" onclick="closeOrderForm()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); margin-top: 10px;">Cancel</button>
            </form>
        </div>

        <div class="filters-section">
            <div class="filters">
                <input type="text" class="search-box" id="searchBox" placeholder="üîç Search books..." oninput="filterBooks()">
                <button class="filter-btn active" onclick="setFilter('all')">All Books</button>
                <button class="filter-btn" onclick="setFilter('ebook')">Ebooks Only</button>
                <button class="filter-btn" onclick="setFilter('physical')">Physical Only</button>
                <button class="filter-btn" onclick="setFilter('cheap')">Under 5T</button>
                <button class="filter-btn" onclick="setFilter('popular')">Popular</button>
            </div>
        </div>
        <div class="books-grid" id="booksGrid"></div>
        <div class="cart-section">
            <div class="cart">
                <h3>üõí Purchase History</h3>
                <div id="cartItems"></div>
            </div>
            <div class="cart-summary">
                <h3>üìä Statistics</h3>
                <div class="summary-row">
                    <span>Total Purchases:</span>
                    <span id="totalPurchases">0</span>
                </div>
                <div class="summary-row">
                    <span>Tickets Spent:</span>
                    <span id="ticketsSpent">0</span>
                </div>
                <div class="summary-row">
                    <span>Tickets Earned:</span>
                    <span id="ticketsEarned">0</span>
                </div>
                <div class="summary-row">
                    <span>Favorite Type:</span>
                    <span id="favoriteType">-</span>
                </div>
                <button class="checkout-btn" onclick="showStats()">üìà View Detailed Stats</button>
            </div>
        </div>
    </div>
    <div id="previewModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closePreview()">&times;</span>
            <h2 id="previewTitle" style="color: #667eea; margin-bottom: 20px;"></h2>
            <div id="previewText" class="preview-text"></div>
        </div>
    </div>
    <div id="notification" class="notification"></div>
    
    <div id="adminLoginModal" class="modal">
        <div class="modal-content" style="max-width: 450px;">
            <span class="close-btn" onclick="closeAdminLogin()">&times;</span>
            <h2 style="color: #667eea; margin-bottom: 30px; text-align: center;">üîê Admin Login</h2>
            <form id="adminLoginForm" onsubmit="checkAdminPassword(event)">
                <div class="form-group">
                    <label for="adminUsername">Username:</label>
                    <input type="text" id="adminUsername" required style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px;">
                </div>
                <div class="form-group">
                    <label for="adminPassword">Password:</label>
                    <input type="password" id="adminPassword" required style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px;">
                </div>
                <button type="submit" class="checkout-btn">Login</button>
            </form>
        </div>
    </div>

    <div id="adminPanel" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 1200px; max-height: 90vh; overflow-y: auto;">
            <span class="close-btn" onclick="closeAdminPanel()">&times;</span>
            <h2 style="color: #667eea; margin-bottom: 30px; text-align: center;">üëë Admin Control Panel</h2>
            
            <div style="display: flex; gap: 20px; margin-bottom: 30px; flex-wrap: wrap;">
                <button class="customize-btn" onclick="showAdminTab('addBook')">‚ûï Add Book</button>
                <button class="customize-btn" onclick="showAdminTab('manageBooks')">üìö Manage Books</button>
                <button class="customize-btn" onclick="showAdminTab('viewOrders')">üõí View Orders</button>
                <button class="customize-btn" onclick="showAdminTab('settings')">‚öôÔ∏è Settings</button>
            </div>

            <div id="adminAddBook" class="admin-section" style="display: block;">
                <h3 style="color: #667eea; margin-bottom: 20px;">Add New Book</h3>
                <form id="adminBookForm" onsubmit="addBookAdmin(event)">
                    <div class="form-group">
                        <label>Book Title:</label>
                        <input type="text" id="adminBookTitle" required>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="form-group">
                            <label>Ebook Price (Tickets):</label>
                            <input type="number" id="adminEbookPrice" required>
                        </div>
                        <div class="form-group">
                            <label>Physical Price (Tickets):</label>
                            <input type="number" id="adminPhysicalPrice" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Rating (0-5):</label>
                        <input type="number" step="0.1" min="0" max="5" id="adminRating" value="4.5">
                    </div>
                    <div class="form-group">
                        <label>Badge (Optional):</label>
                        <input type="text" id="adminBadge" placeholder="e.g., BESTSELLER, NEW">
                    </div>
                    <div class="form-group">
                        <label>Mark as Popular:</label>
                        <select id="adminPopular">
                            <option value="false">No</option>
                            <option value="true">Yes</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Book Preview:</label>
                        <textarea id="adminPreview" required></textarea>
                    </div>
                    <button type="submit" class="checkout-btn">Add Book</button>
                </form>
            </div>

            <div id="adminManageBooks" class="admin-section" style="display: none;">
                <h3 style="color: #667eea; margin-bottom: 20px;">Manage Books</h3>
                <div id="adminBooksList"></div>
            </div>

            <div id="adminViewOrders" class="admin-section" style="display: none;">
                <h3 style="color: #667eea; margin-bottom: 20px;">Recent Orders</h3>
                <div id="adminOrdersList"></div>
            </div>

            <div id="adminSettings" class="admin-section" style="display: none;">
                <h3 style="color: #667eea; margin-bottom: 20px;">Store Settings</h3>
                <div class="form-group">
                    <label>Store Name:</label>
                    <input type="text" id="storeName" value="Random Park Books">
                </div>
                <div class="form-group">
                    <label>Banner Message:</label>
                    <input type="text" id="bannerMessage" value="üéâ National Coffee Day Special! üéâ">
                </div>
                <div class="form-group">
                    <label>Default Starting Tickets:</label>
                    <input type="number" id="defaultTickets" value="100">
                </div>
                <button class="checkout-btn" onclick="saveSettings()">üíæ Save Settings</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <script>
        const API_URL = 'http://localhost:5000'; // Backend API URL
        const ADMIN_PASSWORD = 'jrp977';
        const ADMIN_USERNAME = 'admin';
        
        let tickets = 0;
        let userName = '';
        let userEmail = '';
        let userAvatar = 'üòä';
        let userColor = 'purple';
        let booksPurchased = 0;
        let totalSpent = 0;
        let totalSaved = 0;
        let ticketsEarned = 0;
        let ebooksOwned = 0;
        let physicalOwned = 0;
        let currentFilter = 'all';
        const cart = [];
        const purchaseHistory = [];

        const colorThemes = {
            purple: { primary: '#667eea', secondary: '#764ba2' },
            blue: { primary: '#4facfe', secondary: '#00f2fe' },
            pink: { primary: '#f093fb', secondary: '#f5576c' },
            green: { primary: '#43e97b', secondary: '#38f9d7' },
            orange: { primary: '#fa709a', secondary: '#fee140' },
            teal: { primary: '#30cfd0', secondary: '#330867' },
            red: { primary: '#eb3349', secondary: '#f45c43' },
            sunset: { primary: '#ff6e7f', secondary: '#bfe9ff' }
        };

        const books = [];

        // Load books from backend when app starts
        async function loadBooksFromBackend() {
            try {
                const response = await fetch(`${API_URL}/books`);
                if (response.ok) {
                    const backendBooks = await response.json();
                    books.length = 0; // Clear array
                    backendBooks.forEach(book => {
                        books.push({
                            title: book.title,
                            ebookPrice: book.ebook_price,
                            physicalPrice: book.physical_price,
                            rating: book.rating,
                            purchases: book.purchases,
                            popular: book.popular === 1,
                            badge: book.badge || undefined,
                            preview: book.preview
                        });
                    });
                    renderBooks();
                } else {
                    // Fallback to default books if backend is not available
                    loadDefaultBooks();
                }
            } catch (error) {
                console.log('Backend not available, using default books');
                loadDefaultBooks();
            }
        }

        function loadDefaultBooks() {
            books.push(
                {
                    title: "Wacky Whispers",
                    ebookPrice: 4,
                    physicalPrice: 7,
                    rating: 4.5,
                    purchases: 145,
                    preview: `Ellie Voss had been banned from three cactus stores in her town. And not for stealing. Not even for poking the cactuses (which, for the record, she only did once. Okay, twice. Maybe four times. Whatever).

She just had... a reputation.

So when she walked into "Cactus Palace: Where Every Prickle Has a Purpose", the man behind the counter immediately ducked behind a pile of potted succulents.

"Just looking!" Ellie called cheerfully. "No explosions today, I promise!"`
                },
                {
                    title: "Life of a Smashkarts Hero",
                    ebookPrice: 3,
                    physicalPrice: 6,
                    rating: 4.8,
                    purchases: 289,
                    popular: true,
                    preview: `Uggh! Is this how it feels to be in a game! I wish I was back in the customizer.

The only problem is that, My player won't stop crashing me. It feels soooo good when his friend plays with me. It feels like he can sense something.`
                },
                {
                    title: "Life of a Ragdoll Hero",
                    ebookPrice: 3,
                    physicalPrice: 6,
                    rating: 4.6,
                    purchases: 178,
                    preview: `Ragdoll, a person in the game of stickman clash, was living life. Things were going great for him and his family, until that day.

A huge cyborg named LUKE was wrecking havoc and forcing everyone to the games.`
                },
                {
                    title: "Adventures of Maple and the Sky Kingdom",
                    ebookPrice: 6,
                    physicalPrice: 9,
                    rating: 5.0,
                    purchases: 412,
                    popular: true,
                    badge: "BESTSELLER",
                    preview: `Maple Thistlewhip was not supposed to be in the attic.

Her mother had said it plainly: "No climbing that rickety ladder, young lady. There are squirrels up there. Possibly ghosts."

But the wind had whispered her name again. "Maple..."`
                },
                {
                    title: "The Great Sandwich Mystery",
                    ebookPrice: 6,
                    physicalPrice: 9,
                    rating: 4.7,
                    purchases: 234,
                    preview: `Timmy the raccoon opened his lunchbox with ultimate excitement.

Inside should have been the tallest, stickiest, most perfect peanut butter and jelly sandwich in the whole forest.

Now there was nothing left but a sad, soggy lettuce leaf.`
                },
                {
                    title: "Puppet Hockey Hero",
                    ebookPrice: 4,
                    physicalPrice: 7,
                    rating: 4.4,
                    purchases: 167,
                    preview: `It was the last day of Puppet School, it was the day we were graduating.

I got a score of 97/100 which was amazing with the skills I had.`
                },
                {
                    title: "Silent Echoes",
                    ebookPrice: 4,
                    physicalPrice: 7,
                    rating: 4.9,
                    purchases: 198,
                    preview: `The small town of Haven's End had never encountered anything remotely like the vast, shimmering dome that now stretched impossibly over the edge of the ancient forest.

Twelve-year-old Lila Granger stood pressed against her bedroom window, staring wide-eyed at the strange phenomenon.`
                }
            );
            renderBooks();
        }

        function getUserLevel() {
            return Math.floor(booksPurchased / 5) + 1;
        }

        function selectAvatar(emoji) {
            userAvatar = emoji;
            document.querySelectorAll('.welcome-box .avatar-btn').forEach(btn => {
                btn.classList.remove('selected');
                if (btn.textContent === emoji) {
                    btn.classList.add('selected');
                }
            });
        }

        function selectColor(color) {
            userColor = color;
            document.querySelectorAll('.welcome-box .color-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            event.target.classList.add('selected');
        }

        function applyTheme() {
            const theme = colorThemes[userColor];
            document.body.style.background = `linear-gradient(135deg, ${theme.primary} 0%, ${theme.secondary} 100%)`;
            
            const existingStyle = document.getElementById('themeStyle');
            if (existingStyle) existingStyle.remove();
            
            const style = document.createElement('style');
            style.id = 'themeStyle';
            style.innerHTML = `
                .logo { background: linear-gradient(135deg, ${theme.primary} 0%, ${theme.secondary} 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
                .stat-box { background: linear-gradient(135deg, ${theme.primary} 0%, ${theme.secondary} 100%); }
                .customize-btn { background: linear-gradient(135deg, ${theme.primary} 0%, ${theme.secondary} 100%); }
                .banner { background: linear-gradient(135deg, ${theme.primary} 0%, ${theme.secondary} 100%); }
                .filter-btn { border-color: ${theme.primary}; color: ${theme.primary}; }
                .filter-btn.active { background: ${theme.primary}; }
                .price-option { background: linear-gradient(135deg, ${theme.primary} 0%, ${theme.secondary} 100%); }
                .buy-ebook { background: linear-gradient(135deg, ${theme.primary} 0%, ${theme.secondary} 100%); }
                .preview-btn { border-color: ${theme.primary}; color: ${theme.primary}; }
                .preview-btn:hover { background: ${theme.primary}; }
                .cart h3 { color: ${theme.primary}; }
                .order-form-container h3 { color: ${theme.primary}; }
                .notification { background: linear-gradient(135deg, ${theme.primary} 0%, ${theme.secondary} 100%); }
                #previewTitle { color: ${theme.primary}; }
                .customize-section h3 { color: ${theme.primary}; }
            `;
            document.head.appendChild(style);
        }

        function loginWithGoogle() {
            showLoginSuccess('Google');
            userEmail = 'user@gmail.com';
            userName = 'Google User';
            showCustomization();
        }

        function loginWithFacebook() {
            showLoginSuccess('Facebook');
            userEmail = 'user@facebook.com';
            userName = 'Facebook User';
            showCustomization();
        }

        function loginWithApple() {
            showLoginSuccess('Apple');
            userEmail = 'user@icloud.com';
            userName = 'Apple User';
            showCustomization();
        }

        function loginWithEmail() {
            document.querySelector('.login-buttons').style.display = 'none';
            const emailInput = document.getElementById('userEmail');
            emailInput.style.display = 'block';
            emailInput.placeholder = 'Enter your email address';
            document.getElementById('startButton').style.display = 'block';
        }

        function showLoginSuccess(provider) {
            document.querySelector('.login-buttons').style.display = 'none';
            setTimeout(() => {
                document.getElementById('startButton').style.display = 'block';
            }, 500);
        }

        function showCustomization() {
            document.getElementById('startButton').style.display = 'block';
        }

        function startApp() {
            const emailInput = document.getElementById('userEmail');
            
            if (emailInput.style.display === 'block' && !emailInput.value.trim()) {
                alert('Please enter your email!');
                return;
            }
            
            if (emailInput.value.trim()) {
                userEmail = emailInput.value.trim();
                userName = 'Guest';
            }
            
            if (!userName) {
                userName = 'Guest';
                userEmail = 'guest@example.com';
            }
            
            tickets = 100;
            
            document.getElementById('welcomeScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            document.getElementById('displayName').textContent = userName;
            document.getElementById('userAvatar').textContent = userAvatar;
            
            applyTheme();
            loadBooksFromBackend(); // Load books from backend
            updateDisplay();
        }

        function renderBooks() {
            const grid = document.getElementById('booksGrid');
            const searchTerm = document.getElementById('searchBox').value.toLowerCase();
            
            let filteredBooks = books.filter(book => {
                const matchesSearch = book.title.toLowerCase().includes(searchTerm);
                
                if (!matchesSearch) return false;
                
                if (currentFilter === 'all') return true;
                if (currentFilter === 'popular') return book.popular;
                if (currentFilter === 'cheap') return book.ebookPrice < 5;
                if (currentFilter === 'ebook') return true;
                if (currentFilter === 'physical') return true;
                
                return true;
            });
            
            grid.innerHTML = filteredBooks.map((book, index) => {
                const stars = '‚≠ê'.repeat(Math.floor(book.rating)) + (book.rating % 1 >= 0.5 ? '¬Ω' : '');
                
                return `
                <div class="book-card ${book.badge ? 'discounted' : ''}">
                    <div class="book-rating">${stars} (${book.rating})</div>
                    <div class="book-title">
                        ${book.title}
                        ${book.badge ? `<span class="badge">${book.badge}</span>` : ''}
                    </div>
                    <div class="book-meta">
                        <span>üì¶ ${book.purchases} sold</span>
                        ${book.popular ? '<span style="color: #f5576c;">üî• Trending</span>' : ''}
                    </div>
                    <div class="book-prices">
                        <div class="price-option">
                            <div class="price-label">Ebook</div>
                            <div class="price-value">${book.ebookPrice}T</div>
                        </div>
                        <div class="price-option">
                            <div class="price-label">Physical</div>
                            <div class="price-value">${book.physicalPrice}T</div>
                        </div>
                    </div>
                    <div class="buy-buttons">
                        <button class="buy-btn buy-ebook" onclick="buyBook(${books.indexOf(book)}, 'ebook')">
                            Buy Ebook
                        </button>
                        <button class="buy-btn buy-physical" onclick="buyBook(${books.indexOf(book)}, 'physical')">
                            Buy Physical
                        </button>
                    </div>
                    <button class="preview-btn" onclick="showPreview(${books.indexOf(book)})">
                        üìñ Read Preview
                    </button>
                </div>
            `;
            }).join('');
        }

        function buyBook(index, type) {
            const book = books[index];
            const price = type === 'ebook' ? book.ebookPrice : book.physicalPrice;
            
            if (tickets >= price) {
                const oldLevel = getUserLevel();
                
                tickets -= price;
                booksPurchased++;
                totalSpent += price;
                
                if (type === 'ebook') {
                    tickets += 1;
                    ticketsEarned += 1;
                    ebooksOwned++;
                    totalSaved += 1;
                    showNotification(`‚úÖ Purchased ${book.title} (Ebook) for ${price}T! +1 Bonus Ticket!`);
                } else {
                    physicalOwned++;
                    showNotification(`‚úÖ Purchased ${book.title} (Physical) for ${price}T!`);
                }
                
                const purchase = {
                    title: book.title,
                    type: type,
                    price: price,
                    timestamp: new Date().toLocaleString()
                };
                
                cart.push(purchase);
                purchaseHistory.push(purchase);
                
                // Send order to backend
                sendOrderToBackend({
                    user_name: userName,
                    user_email: userEmail,
                    user_avatar: userAvatar,
                    book_title: book.title,
                    book_type: type,
                    price: price
                });
                
                updateDisplay();
                
                const newLevel = getUserLevel();
                if (newLevel > oldLevel) {
                    setTimeout(() => {
                        showNotification(`üéä Level Up! You're now level ${newLevel}!`);
                    }, 2000);
                }
            } else {
                showNotification(`‚ùå Not enough tickets! You need ${price}T but only have ${tickets}T`);
            }
        }

        async function sendOrderToBackend(orderData) {
            try {
                const response = await fetch(`${API_URL}/order`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(orderData)
                });
                
                if (response.ok) {
                    console.log('Order sent to backend successfully');
                    // Reload books to update purchase counts
                    setTimeout(() => loadBooksFromBackend(), 1000);
                } else {
                    console.log('Backend order failed, continuing with local cart');
                }
            } catch (error) {
                console.log('Could not send order to backend:', error);
            }
        }

        function updateDisplay() {
            document.getElementById('ticketCount').textContent = tickets;
            document.getElementById('booksBadge').textContent = booksPurchased;
            document.getElementById('userLevel').textContent = getUserLevel();
            
            const cartItems = document.getElementById('cartItems');
            if (cart.length === 0) {
                cartItems.innerHTML = '<p style="color: #999;">No purchases yet</p>';
            } else {
                cartItems.innerHTML = cart.slice().reverse().map(item => `
                    <div class="cart-item">
                        <div>
                            <strong>${item.title}</strong><br>
                            <small style="color: #666;">${item.type} ‚Ä¢ ${item.timestamp}</small>
                        </div>
                        <span style="font-weight: bold;">${item.price}T</span>
                    </div>
                `).join('');
            }
            
            document.getElementById('totalPurchases').textContent = booksPurchased;
            document.getElementById('ticketsSpent').textContent = totalSpent;
            document.getElementById('ticketsEarned').textContent = ticketsEarned;
            
            if (ebooksOwned > physicalOwned) {
                document.getElementById('favoriteType').textContent = 'Ebook';
            } else if (physicalOwned > ebooksOwned) {
                document.getElementById('favoriteType').textContent = 'Physical';
            } else if (ebooksOwned > 0) {
                document.getElementById('favoriteType').textContent = 'Mixed';
            } else {
                document.getElementById('favoriteType').textContent = '-';
            }
        }

        function showPreview(index) {
            const book = books[index];
            document.getElementById('previewTitle').textContent = book.title;
            document.getElementById('previewText').textContent = book.preview;
            document.getElementById('previewModal').style.display = 'block';
        }

        function closePreview() {
            document.getElementById('previewModal').style.display = 'none';
        }

        function showNotification(message) {
            const notif = document.getElementById('notification');
            notif.textContent = message;
            notif.style.display = 'block';
            setTimeout(() => {
                notif.style.display = 'none';
            }, 3000);
        }

        function setFilter(filter) {
            currentFilter = filter;
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            renderBooks();
        }

        function filterBooks() {
            renderBooks();
        }

        function showStats() {
            const stats = `üìä Detailed Statistics

Total Books Purchased: ${booksPurchased}
Current Level: ${getUserLevel()}
Ebooks Owned: ${ebooksOwned}
Physical Books Owned: ${physicalOwned}

üí∞ Financial Stats:
Total Spent: ${totalSpent}T
Total Saved: ${totalSaved}T
Tickets Earned: ${ticketsEarned}T
Net Spending: ${totalSpent - ticketsEarned}T

üé® Customization:
Current Theme: ${userColor}
            `;
            alert(stats);
        }

        function openOrderForm() {
            document.getElementById('orderFormContainer').style.display = 'block';
            document.getElementById('orderName').value = '';
            document.getElementById('orderEmail').value = userEmail;
            document.getElementById('orderFormContainer').scrollIntoView({ behavior: 'smooth' });
        }

        function closeOrderForm() {
            document.getElementById('orderFormContainer').style.display = 'none';
        }

        function submitOrder(event) {
            event.preventDefault();
            
            const name = document.getElementById('orderName').value;
            const email = document.getElementById('orderEmail').value;
            const details = document.getElementById('orderDetails').value;
            
            // Send order details to backend
            sendOrderToBackend({
                user_name: name,
                user_email: email,
                user_avatar: userAvatar,
                book_title: 'Custom Order',
                book_type: 'email',
                price: 0,
                order_details: details
            });
            
            showNotification('üìß Order request sent successfully! You will receive a confirmation email.');
            
            console.log('Order Details:', {
                name: name,
                email: email,
                orderDetails: details,
                currentTickets: tickets,
                purchaseHistory: purchaseHistory
            });
            
            closeOrderForm();
        }

        // Admin Functions
        function openAdminLogin() {
            document.getElementById('adminLoginModal').style.display = 'block';
        }

        function closeAdminLogin() {
            document.getElementById('adminLoginModal').style.display = 'none';
            document.getElementById('adminLoginForm').reset();
        }

        function checkAdminPassword(event) {
            event.preventDefault();
            const username = document.getElementById('adminUsername').value;
            const password = document.getElementById('adminPassword').value;

            if (username === ADMIN_USERNAME && password === ADMIN_PASSWORD) {
                closeAdminLogin();
                openAdminPanel();
                showNotification('‚úÖ Welcome Admin!');
            } else {
                showNotification('‚ùå Invalid credentials! Returning to home...');
                setTimeout(() => {
                    closeAdminLogin();
                }, 2000);
            }
        }

        function openAdminPanel() {
            document.getElementById('adminPanel').style.display = 'block';
            loadAdminBooks();
            loadAdminOrders();
        }

        function closeAdminPanel() {
            document.getElementById('adminPanel').style.display = 'none';
        }

        function showAdminTab(tab) {
            document.querySelectorAll('.admin-section').forEach(section => {
                section.style.display = 'none';
            });

            if (tab === 'addBook') {
                document.getElementById('adminAddBook').style.display = 'block';
            } else if (tab === 'manageBooks') {
                document.getElementById('adminManageBooks').style.display = 'block';
                loadAdminBooks();
            } else if (tab === 'viewOrders') {
                document.getElementById('adminViewOrders').style.display = 'block';
                loadAdminOrders();
            } else if (tab === 'settings') {
                document.getElementById('adminSettings').style.display = 'block';
            }
        }

        function addBookAdmin(event) {
            event.preventDefault();

            const newBook = {
                title: document.getElementById('adminBookTitle').value,
                ebookPrice: parseInt(document.getElementById('adminEbookPrice').value),
                physicalPrice: parseInt(document.getElementById('adminPhysicalPrice').value),
                rating: parseFloat(document.getElementById('adminRating').value),
                badge: document.getElementById('adminBadge').value,
                popular: document.getElementById('adminPopular').value === 'true',
                preview: document.getElementById('adminPreview').value,
                purchases: 0
            };

            books.push(newBook);
            renderBooks();
            showNotification('‚úÖ Book added successfully!');
            document.getElementById('adminBookForm').reset();
            
            // Also send to backend if available
            fetch(`${API_URL}/admin/books`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    title: newBook.title,
                    ebook_price: newBook.ebookPrice,
                    physical_price: newBook.physicalPrice,
                    rating: newBook.rating,
                    badge: newBook.badge,
                    popular: newBook.popular ? 1 : 0,
                    preview: newBook.preview
                })
            }).catch(err => console.log('Backend not available'));
        }

        function loadAdminBooks() {
            const container = document.getElementById('adminBooksList');
            container.innerHTML = books.map((book, index) => `
                <div class="admin-book-item">
                    <div>
                        <strong>${book.title}</strong><br>
                        <small>Ebook: ${book.ebookPrice}T | Physical: ${book.physicalPrice}T | Rating: ${book.rating}‚≠ê | Sold: ${book.purchases}</small>
                    </div>
                    <button class="admin-btn-delete" onclick="deleteBookAdmin(${index})">üóëÔ∏è Delete</button>
                </div>
            `).join('');
        }

        function deleteBookAdmin(index) {
            if (!confirm('Are you sure you want to delete this book?')) return;
            
            books.splice(index, 1);
            renderBooks();
            loadAdminBooks();
            showNotification('‚úÖ Book deleted successfully!');
        }

        function loadAdminOrders() {
            const container = document.getElementById('adminOrdersList');
            if (purchaseHistory.length === 0) {
                container.innerHTML = '<p style="color: #999;">No orders yet</p>';
                return;
            }

            container.innerHTML = purchaseHistory.slice().reverse().map(order => `
                <div class="admin-book-item">
                    <div>
                        <strong>${order.title}</strong> (${order.type})<br>
                        <small>Price: ${order.price}T | Date: ${order.timestamp}</small>
                    </div>
                </div>
            `).join('');
        }

        function saveSettings() {
            const storeName = document.getElementById('storeName').value;
            const bannerMsg = document.getElementById('bannerMessage').value;
            const defaultTix = parseInt(document.getElementById('defaultTickets').value);

            document.querySelector('.logo').textContent = 'üìö ' + storeName;
            document.querySelector('.banner h2').textContent = bannerMsg;
            
            showNotification('‚úÖ Settings saved successfully!');
        }

        window.onclick = function(event) {
            const previewModal = document.getElementById('previewModal');
            const adminLoginModal = document.getElementById('adminLoginModal');
            const adminPanel = document.getElementById('adminPanel');
            
            if (event.target === previewModal) {
                closePreview();
            }
            if (event.target === adminLoginModal) {
                closeAdminLogin();
            }
            if (event.target === adminPanel) {
                closeAdminPanel();
            }
        }
    </script>
</body>
</html>
