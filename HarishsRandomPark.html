<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Random Park Books - Buy Books Online</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        /* Welcome Screen */
        .welcome-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            z-index: 3000;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.5s;
        }
        
        .welcome-box {
            background: white;
            padding: 50px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 500px;
            width: 90%;
            text-align: center;
            animation: slideUp 0.6s;
        }
        
        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .welcome-icon {
            font-size: 64px;
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .welcome-box h1 {
            color: #667eea;
            margin-bottom: 30px;
            font-size: 32px;
        }
        
        .login-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 600;
            font-size: 14px;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
            font-family: inherit;
        }

        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .customize-section {
            margin-top: 25px;
            padding-top: 25px;
            border-top: 2px solid #f0f0f0;
        }
        
        .customize-section h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .avatar-options {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        
        .avatar-btn {
            font-size: 35px;
            padding: 8px;
            border: 3px solid transparent;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s;
            background: #f8f9fa;
        }
        
        .avatar-btn:hover {
            transform: scale(1.2);
        }
        
        .avatar-btn.selected {
            border-color: #667eea;
            background: #e8eaf6;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        .color-options {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .color-btn {
            width: 100%;
            height: 50px;
            border: 3px solid transparent;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .color-btn:hover {
            transform: scale(1.1);
        }
        
        .color-btn.selected {
            border-color: #333;
            box-shadow: 0 0 0 2px white, 0 0 0 5px #333;
        }
        
        .start-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .start-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .start-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Header */
        header {
            background: rgba(255, 255, 255, 0.98);
            padding: 25px 30px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            backdrop-filter: blur(10px);
        }
        
        .logo {
            font-size: 32px;
            font-weight: 800;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.5px;
        }
        
        .header-right {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .stats-panel {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .stat-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 12px 18px;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .stat-box:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            padding: 14px 28px;
            border-radius: 30px;
            color: white;
            font-weight: bold;
            font-size: 18px;
            box-shadow: 0 4px 15px rgba(245, 87, 108, 0.4);
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .user-info:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(245, 87, 108, 0.6);
        }

        .logout-btn {
            background: linear-gradient(135deg, #f5576c 0%, #f093fb 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(245, 87, 108, 0.3);
        }

        .logout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(245, 87, 108, 0.5);
        }
        
        /* Banner */
        .banner {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            padding: 25px;
            border-radius: 20px;
            color: white;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .banner h2 {
            font-size: 24px;
            margin-bottom: 8px;
        }
        
        .banner p {
            font-size: 16px;
            opacity: 0.95;
        }
        
        /* Filters */
        .filters-section {
            background: white;
            padding: 25px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .filters {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .search-box {
            padding: 12px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 14px;
            flex: 1;
            min-width: 200px;
            transition: all 0.3s;
        }
        
        .search-box:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .filter-btn {
            padding: 10px 20px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .filter-btn:hover {
            background: #f8f9ff;
        }
        
        .filter-btn.active {
            background: #667eea;
            color: white;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        /* Books Grid */
        .books-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .book-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .book-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transform: scaleX(0);
            transition: transform 0.3s;
        }
        
        .book-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 16px 48px rgba(0, 0, 0, 0.15);
        }
        
        .book-card:hover::before {
            transform: scaleX(1);
        }
        
        .book-card.featured::after {
            content: 'üî• HOT';
            position: absolute;
            top: 15px;
            right: 15px;
            background: #f5576c;
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: bold;
        }
        
        .book-card.delivered-book {
            border: 3px solid #43e97b;
            box-shadow: 0 8px 32px rgba(67, 233, 123, 0.3);
        }
        
        .book-card.delivered-book::before {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            transform: scaleX(1);
        }
        
        .book-rating {
            display: flex;
            gap: 5px;
            margin-bottom: 12px;
            font-size: 16px;
        }
        
        .book-title {
            font-size: 22px;
            font-weight: 700;
            color: #333;
            margin-bottom: 15px;
            line-height: 1.4;
        }
        
        .book-meta {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            font-size: 13px;
            color: #666;
            flex-wrap: wrap;
        }
        
        .badge {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 700;
            margin-left: 8px;
            text-transform: uppercase;
        }
        
        .book-prices {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 15px;
        }
        
        .price-option {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            font-weight: 600;
        }
        
        .price-label {
            font-size: 12px;
            opacity: 0.9;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .price-value {
            font-size: 22px;
            font-weight: 700;
        }
        
        .buy-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .buy-btn {
            padding: 14px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }
        
        .add-ebook {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .add-physical {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }
        
        .buy-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .preview-btn {
            width: 100%;
            padding: 12px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .preview-btn:hover {
            background: #667eea;
            color: white;
        }
        
        /* Cart Section */
        .cart-section {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .cart {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .cart h3 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 24px;
        }
        
        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            margin-bottom: 12px;
            border-radius: 12px;
            transition: all 0.3s;
        }
        
        .cart-item:hover {
            background: #e8eaf6;
        }

        .remove-item {
            background: #f5576c;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }

        .remove-item:hover {
            background: #d43f56;
        }
        
        .cart-summary {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
            font-size: 15px;
        }
        
        .summary-row:last-of-type {
            border-bottom: none;
        }

        .checkout-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s;
        }

        .checkout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(67, 233, 123, 0.4);
        }

        .checkout-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            overflow-y: auto;
            animation: fadeIn 0.3s;
        }
        
        .modal-content {
            background: white;
            max-width: 700px;
            margin: 50px auto;
            padding: 40px;
            border-radius: 20px;
            position: relative;
            animation: slideUp 0.3s;
        }
        
        .close-btn {
            position: absolute;
            top: 20px;
            right: 25px;
            font-size: 30px;
            cursor: pointer;
            color: #999;
            transition: all 0.3s;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        
        .close-btn:hover {
            color: #333;
            background: #f0f0f0;
        }
        
        .preview-text {
            line-height: 1.8;
            color: #333;
            white-space: pre-wrap;
            font-size: 16px;
        }

        /* Admin Panel */
        .admin-book-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
        }

        .admin-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .admin-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .admin-btn-edit {
            background: #667eea;
            color: white;
        }

        .admin-btn-delete {
            background: #f5576c;
            color: white;
        }

        .admin-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .admin-tab {
            padding: 12px 24px;
            background: white;
            border: 2px solid #667eea;
            color: #667eea;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .admin-tab.active {
            background: #667eea;
            color: white;
        }

        .admin-section {
            display: none;
        }

        .admin-section.active {
            display: block;
        }

        /* Achievements */
        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .achievement {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            transition: all 0.3s;
        }

        .achievement.unlocked {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
        }

        .achievement-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }

        .achievement-title {
            font-weight: 700;
            margin-bottom: 5px;
        }

        .achievement-desc {
            font-size: 12px;
            opacity: 0.8;
        }
        
        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 18px 28px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            z-index: 2000;
            display: none;
            animation: slideInRight 0.3s;
            max-width: 400px;
            font-weight: 600;
        }
        
        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        
        #bookReaderModal .modal-content {
            position: relative;
            overflow: hidden;
        }
        
        #bookReaderModal .modal-content::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(67, 233, 123, 0.1) 0%, transparent 70%);
            animation: pulse 4s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.5; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.1); }
        }
        
        /* Responsive */
        @media (max-width: 1024px) {
            .cart-section {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .welcome-box {
                padding: 30px 20px;
            }
            
            header {
                padding: 20px;
                flex-direction: column;
                align-items: stretch;
            }
            
            .header-right {
                flex-direction: column;
            }
            
            .books-grid {
                grid-template-columns: 1fr;
            }
            
            .book-prices {
                grid-template-columns: 1fr;
            }
            
            .buy-buttons {
                grid-template-columns: 1fr;
            }
            
            .color-options {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        @media (max-width: 480px) {
            .logo {
                font-size: 24px;
            }
            
            .banner h2 {
                font-size: 18px;
            }
            
            .filters {
                flex-direction: column;
            }
            
            .search-box {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Welcome Screen -->
    <div id="welcomeScreen" class="welcome-screen">
        <div class="welcome-box">
            <div class="welcome-icon">üìö</div>
            <h1>Welcome to Random Park Books!</h1>
            
            <div class="login-buttons" id="loginButtons">
                <div class="form-group">
                    <label for="firstName">First Name:</label>
                    <input type="text" id="firstName" placeholder="Enter your first name" required>
                </div>
                <div class="form-group">
                    <label for="lastName">Last Name:</label>
                    <input type="text" id="lastName" placeholder="Enter your last name" required>
                </div>
            </div>
            
            <div class="customize-section">
                <h3>Choose Your Avatar</h3>
                <div class="avatar-options">
                    <button class="avatar-btn selected" onclick="selectAvatar(this, 'üòä')">üòä</button>
                    <button class="avatar-btn" onclick="selectAvatar(this, 'üòÉ')">üòÉ</button>
                    <button class="avatar-btn" onclick="selectAvatar(this, 'üôÇ')">üôÇ</button>
                    <button class="avatar-btn" onclick="selectAvatar(this, 'üòÑ')">üòÑ</button>
                    <button class="avatar-btn" onclick="selectAvatar(this, 'üòÅ')">üòÅ</button>
                    <button class="avatar-btn" onclick="selectAvatar(this, 'üòÜ')">üòÜ</button>
                </div>
            </div>
            
            <div class="customize-section">
                <h3>Choose Your Theme</h3>
                <div class="color-options">
                    <button class="color-btn selected" onclick="selectColor(this, 'purple')" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);"></button>
                    <button class="color-btn" onclick="selectColor(this, 'blue')" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);"></button>
                    <button class="color-btn" onclick="selectColor(this, 'pink')" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);"></button>
                    <button class="color-btn" onclick="selectColor(this, 'green')" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);"></button>
                </div>
            </div>
            
            <button class="start-btn" onclick="startApp()" id="startBtn">Continue to Store üõçÔ∏è</button>
        </div>
    </div>

    <!-- Main App -->
    <div class="container" id="mainApp" style="display: none;">
        <header>
            <div class="logo">üìö Random Park Books</div>
            <div class="header-right">
                <div class="stats-panel">
                    <div class="stat-box" onclick="showAchievements()">
                        <span>üèÜ</span>
                        <span><span id="achievementCount">0</span>/<span id="totalAchievements">8</span></span>
                    </div>
                    <div class="stat-box" onclick="showProfile()">
                        <span>‚öôÔ∏è</span>
                        <span>Profile</span>
                    </div>
                    <div class="stat-box" onclick="openAdminLogin()">
                        <span>üîê</span>
                        <span>Admin</span>
                    </div>
                </div>
                <div class="user-info">
                    <span id="userAvatar">üòä</span>
                    <span id="displayName">Guest</span>
                </div>
            </div>
        </header>

        <div class="banner">
            <h2>üéâ Find Your Next Favorite Book! üéâ</h2>
            <p>Browse our collection ‚Ä¢ Add to cart ‚Ä¢ Checkout via email</p>
        </div>

        <div class="filters-section">
            <div class="filters">
                <input type="text" class="search-box" id="searchBox" placeholder="üîç Search books..." oninput="filterBooks()">
                <button class="filter-btn active" onclick="setFilter('all')">All Books</button>
                <button class="filter-btn" onclick="setFilter('ebook')">eBooks</button>
                <button class="filter-btn" onclick="setFilter('physical')">Physical</button>
                <button class="filter-btn" onclick="setFilter('popular')">Popular</button>
            </div>
        </div>

        <div class="books-grid" id="booksGrid"></div>

        <div class="cart-section">
            <div class="cart">
                <h3>üõí Shopping Cart</h3>
                <div id="cartItems">
                    <p style="color: #999;">Your cart is empty. Add some books!</p>
                </div>
            </div>
            
            <div class="cart-summary">
                <h3>üìä Cart Summary</h3>
                <div class="summary-row">
                    <span>Items in Cart:</span>
                    <span id="totalItems">0</span>
                </div>
                <div class="summary-row">
                    <span>Total eBooks:</span>
                    <span id="ebookCount">0</span>
                </div>
                <div class="summary-row">
                    <span>Total Physical:</span>
                    <span id="physicalCount">0</span>
                </div>
                <button class="checkout-btn" onclick="proceedToCheckout()" id="checkoutBtn" disabled>
                    üìß Proceed to Checkout
                </button>
            </div>
        </div>
    </div>

    <!-- Preview Modal -->
    <div id="previewModal" class="modal" onclick="closeModal(event, 'previewModal')">
        <div class="modal-content" onclick="event.stopPropagation()">
            <span class="close-btn" onclick="closePreview()">&times;</span>
            <h2 id="previewTitle" style="color: #667eea; margin-bottom: 20px;"></h2>
            <div id="previewText" class="preview-text"></div>
        </div>
    </div>

    <!-- Profile Modal -->
    <div id="profileModal" class="modal" onclick="closeModal(event, 'profileModal')">
        <div class="modal-content" style="max-width: 900px; max-height: 90vh; overflow-y: auto;" onclick="event.stopPropagation()">
            <span class="close-btn" onclick="closeProfile()">&times;</span>
            <h2 style="color: #667eea; margin-bottom: 30px;">üë§ Your Profile</h2>
            
            <div class="form-group">
                <label>Name:</label>
                <input type="text" id="profileName" onchange="updateProfile()">
            </div>
            
            <div class="customize-section">
                <h3>Change Avatar</h3>
                <div class="avatar-options">
                    <button class="avatar-btn" onclick="updateAvatar(this, 'üòä')">üòä</button>
                    <button class="avatar-btn" onclick="updateAvatar(this, 'üòÉ')">üòÉ</button>
                    <button class="avatar-btn" onclick="updateAvatar(this, 'üôÇ')">üôÇ</button>
                    <button class="avatar-btn" onclick="updateAvatar(this, 'üòÑ')">üòÑ</button>
                    <button class="avatar-btn" onclick="updateAvatar(this, 'üòÅ')">üòÅ</button>
                    <button class="avatar-btn" onclick="updateAvatar(this, 'üòÜ')">üòÜ</button>
                    <button class="avatar-btn" onclick="updateAvatar(this, 'ü§ì')">ü§ì</button>
                    <button class="avatar-btn" onclick="updateAvatar(this, 'üòé')">üòé</button>
                    <button class="avatar-btn" onclick="updateAvatar(this, 'ü•≥')">ü•≥</button>
                    <button class="avatar-btn" onclick="updateAvatar(this, 'ü§©')">ü§©</button>
                </div>
            </div>
            
            <div class="customize-section">
                <h3>Change Theme</h3>
                <div class="color-options">
                    <button class="color-btn" onclick="updateTheme(this, 'purple')" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);"></button>
                    <button class="color-btn" onclick="updateTheme(this, 'blue')" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);"></button>
                    <button class="color-btn" onclick="updateTheme(this, 'pink')" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);"></button>
                    <button class="color-btn" onclick="updateTheme(this, 'green')" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);"></button>
                    <button class="color-btn" onclick="updateTheme(this, 'orange')" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);"></button>
                    <button class="color-btn" onclick="updateTheme(this, 'teal')" style="background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);"></button>
                </div>
            </div>

            <div class="summary-row" style="margin-top: 20px;">
                <span>Total Purchases:</span>
                <span id="profilePurchases">0</span>
            </div>

            <div class="customize-section">
                <h3 id="ordersHeader">üì¶ Your Orders</h3>
                <div id="profileOrdersList"></div>
            </div>

            <button class="logout-btn" onclick="logout()" style="width: 100%; margin-top: 20px;">üö™ Logout</button>
        </div>
    </div>

    <!-- Achievements Modal -->
    <div id="achievementsModal" class="modal" onclick="closeModal(event, 'achievementsModal')">
        <div class="modal-content" onclick="event.stopPropagation()">
            <span class="close-btn" onclick="closeAchievements()">&times;</span>
            <h2 style="color: #667eea; margin-bottom: 30px;">üèÜ Achievements</h2>
            <div class="achievements-grid" id="achievementsList"></div>
        </div>
    </div>

    <!-- Admin Login Modal -->
    <div id="adminLoginModal" class="modal" onclick="closeModal(event, 'adminLoginModal')">
        <div class="modal-content" style="max-width: 450px;" onclick="event.stopPropagation()">
            <span class="close-btn" onclick="closeAdminLogin()">&times;</span>
            <h2 style="color: #667eea; margin-bottom: 30px; text-align: center;">üîê Admin Login</h2>
            <div class="form-group">
                <label for="adminPassword">Enter Admin Password:</label>
                <input type="password" id="adminPassword" placeholder="Enter password">
            </div>
            <button class="checkout-btn" onclick="checkAdminPassword()">Login</button>
        </div>
    </div>

    <!-- Admin Panel -->
    <div id="adminPanel" class="modal" onclick="closeModal(event, 'adminPanel')">
        <div class="modal-content" style="max-width: 1200px; max-height: 90vh; overflow-y: auto;" onclick="event.stopPropagation()">
            <span class="close-btn" onclick="closeAdminPanel()">&times;</span>
            <h2 style="color: #667eea; margin-bottom: 30px; text-align: center;">üëë Admin Control Panel</h2>
            
            <div class="admin-tabs">
                <button class="admin-tab active" onclick="showAdminTab('books')">üìö Manage Books</button>
                <button class="admin-tab" onclick="showAdminTab('add')">‚ûï Add Book</button>
                <button class="admin-tab" onclick="showAdminTab('orders')">üìß Orders</button>
            </div>

            <div id="adminBooksSection" class="admin-section active">
                <h3 style="color: #667eea; margin-bottom: 20px;">All Books</h3>
                <div id="adminBooksList"></div>
            </div>

            <div id="adminAddSection" class="admin-section">
                <h3 style="color: #667eea; margin-bottom: 20px;">Add New Book</h3>
                <div class="form-group">
                    <label>Book Title:</label>
                    <input type="text" id="newBookTitle">
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label>eBook Price ($):</label>
                        <input type="number" id="newBookEbook" value="5">
                    </div>
                    <div class="form-group">
                        <label>Physical Price ($):</label>
                        <input type="number" id="newBookPhysical" value="10">
                    </div>
                </div>
                <div class="form-group">
                    <label>Rating (0-5):</label>
                    <input type="number" step="0.1" min="0" max="5" id="newBookRating" value="4.5">
                </div>
                <div class="form-group">
                    <label>Sales Count:</label>
                    <input type="number" id="newBookSales" value="0">
                </div>
                <div class="form-group">
                    <label>Badge (optional):</label>
                    <input type="text" id="newBookBadge" placeholder="e.g., BESTSELLER, NEW">
                </div>
                <div class="form-group">
                    <label>Mark as Popular:</label>
                    <input type="checkbox" id="newBookPopular">
                </div>
                <div class="form-group">
                    <label>Book Preview:</label>
                    <textarea id="newBookPreview" rows="5"></textarea>
                </div>
                <button class="checkout-btn" onclick="addNewBook()">Add Book</button>
            </div>

            <div id="adminOrdersSection" class="admin-section">
                <h3 style="color: #667eea; margin-bottom: 20px;">Customer Orders</h3>
                <div id="adminOrdersList">
                    <p style="color: #999;">No orders yet.</p>
                </div>
                
                <div style="margin-top: 40px; padding-top: 30px; border-top: 3px solid #667eea;">
                    <h3 style="color: #667eea; margin-bottom: 20px;">üìö Deliver Book Directly</h3>
                    <p style="color: #666; margin-bottom: 20px;">Send a book directly to a customer without them placing an order.</p>
                    
                    <div class="form-group">
                        <label>Customer Name:</label>
                        <input type="text" id="deliverCustomerName" placeholder="e.g., Anne Bell">
                    </div>
                    
                    <div class="form-group">
                        <label>Select Book:</label>
                        <select id="deliverBookSelect" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px;">
                            <option value="">-- Choose a book --</option>
                        </select>
                    </div>
                    
                    <button class="checkout-btn" onclick="deliverBookToCustomer()">üì§ Send Book to Customer</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Checkout Modal -->
    <div id="checkoutModal" class="modal" onclick="closeModal(event, 'checkoutModal')">
        <div class="modal-content" onclick="event.stopPropagation()">
            <span class="close-btn" onclick="closeCheckout()">&times;</span>
            <h2 style="color: #667eea; margin-bottom: 30px;">üìß Complete Your Order</h2>
            
            <div style="background: #f8f9fa; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                <h3 style="margin-bottom: 10px;">Order Summary:</h3>
                <div id="checkoutSummary"></div>
            </div>

            <div class="form-group">
                <label>Your Name:</label>
                <input type="text" id="checkoutName" readonly>
            </div>
            <div class="form-group">
                <label>Your Email:</label>
                <input type="email" id="checkoutEmail" readonly>
            </div>
            <div class="form-group">
                <label>Additional Notes (optional):</label>
                <textarea id="checkoutNotes" rows="3" placeholder="Any special requests or delivery instructions..."></textarea>
            </div>
            
            <button class="checkout-btn" onclick="confirmOrder()">‚úÖ Confirm & Send Order</button>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification"></div>
    
    <!-- Book Reader Modal -->
    <div id="bookReaderModal" class="modal" onclick="closeModal(event, 'bookReaderModal')">
        <div class="modal-content" style="max-width: 900px; max-height: 90vh; overflow-y: auto; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%); color: white; box-shadow: 0 0 50px rgba(102, 126, 234, 0.5);" onclick="event.stopPropagation()">
            <span class="close-btn" onclick="closeBookReader()" style="color: white;">&times;</span>
            
            <div style="text-align: center; padding: 40px 20px;">
                <div style="font-size: 60px; margin-bottom: 20px; animation: float 3s ease-in-out infinite;">üìñ</div>
                <h2 id="readerBookTitle" style="color: #43e97b; margin-bottom: 30px; font-size: 32px; text-shadow: 0 0 20px rgba(67, 233, 123, 0.5);"></h2>
                
                <div style="background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border-radius: 20px; padding: 40px; margin: 20px 0; border: 2px solid rgba(67, 233, 123, 0.3); box-shadow: 0 0 30px rgba(67, 233, 123, 0.2);">
                    <div id="readerBookContent" style="line-height: 2; font-size: 18px; text-align: left; white-space: pre-wrap; color: #e0e0e0;"></div>
                </div>
                
                <div style="margin-top: 30px; font-size: 24px; opacity: 0.7;">‚ú® ‚≠ê ‚ú®</div>
            </div>
        </div>
    </div>

    <script>
        // Obfuscated admin password (Base64 encoded)
        const ADMIN_PASSWORD = (function() {
            const encoded = 'ZXVyZWth'; // Base64 encoded password
            return atob(encoded);
        })();
        
        // Storage key for logged in users
        const LOGGED_IN_USERS_KEY = 'randomParkBooks_loggedInUsers';
        
        // Get currently logged in users
        function getLoggedInUsers() {
            const stored = localStorage.getItem(LOGGED_IN_USERS_KEY);
            return stored ? JSON.parse(stored) : [];
        }
        
        // Check if user is already logged in
        function isUserLoggedIn(firstName, lastName) {
            const loggedIn = getLoggedInUsers();
            return loggedIn.some(user => 
                user.first.toLowerCase() === firstName.toLowerCase() && 
                user.last.toLowerCase() === lastName.toLowerCase()
            );
        }
        
        // Add user to logged in list
        function addLoggedInUser(firstName, lastName) {
            const loggedIn = getLoggedInUsers();
            loggedIn.push({ first: firstName, last: lastName, timestamp: Date.now() });
            localStorage.setItem(LOGGED_IN_USERS_KEY, JSON.stringify(loggedIn));
        }
        
        // Remove user from logged in list
        function removeLoggedInUser(firstName, lastName) {
            const loggedIn = getLoggedInUsers();
            const filtered = loggedIn.filter(user => 
                !(user.first.toLowerCase() === firstName.toLowerCase() && 
                  user.last.toLowerCase() === lastName.toLowerCase())
            );
            localStorage.setItem(LOGGED_IN_USERS_KEY, JSON.stringify(filtered));
        }
        
        // Authorized users list
        const AUTHORIZED_USERS = [
            { first: 'Unown', last: 'S' },
            { first: 'Anne', last: 'Bell' },
            { first: 'Cameron', last: 'Hughes' },
            { first: 'Sophie', last: 'Lambert' },
            { first: 'Evan', last: 'Morrison' },
            { first: 'Christian', last: 'Dyer' },
            { first: 'Nathan', last: 'Marshall' },
            { first: 'Sebastian', last: 'Graham' },
            { first: 'Evan', last: 'Henderson' },
            { first: 'Brandon', last: 'Clark' },
            { first: 'Carolyn', last: 'Clarkson' },
            { first: 'Ian', last: 'Fraser' },
            { first: 'Keith', last: 'Hart' },
            { first: 'Gabrielle', last: 'Hamilton' },
            { first: 'Nicola', last: 'Jackson' },
            { first: 'Joan', last: 'Randall' },
            { first: 'Alison', last: 'McLean' },
            { first: 'Irene', last: 'Hudson' },
            { first: 'Julia', last: 'Ogden' },
            { first: 'Jason', last: 'Piper' },
            { first: 'Julian', last: 'Berry' },
            { first: 'Pippa', last: 'Roberts' },
            { first: 'Bella', last: 'Davies' },
            { first: 'Carolyn', last: 'Fisher' },
            { first: 'Anne', last: 'Clark' },
            { first: 'Matt', last: 'Gray' },
            { first: 'Victor', last: 'Bell' },
            { first: 'Rachel', last: 'Jackson' },
            { first: 'Jan', last: 'Vaughan' },
            { first: 'John', last: 'Ball' },
            { first: 'Phil', last: 'Cameron' }
        ];
        
        // Check if user is special admin
        function isSpecialAdmin(firstName, lastName) {
            return firstName.toLowerCase() === 'unown' && lastName.toLowerCase() === 's';
        }
        
        // Check if user is authorized
        function isAuthorizedUser(firstName, lastName) {
            return AUTHORIZED_USERS.some(user => 
                user.first.toLowerCase() === firstName.toLowerCase() && 
                user.last.toLowerCase() === lastName.toLowerCase()
            );
        }
        
        // App State
        let state = {
            name: '',
            email: '',
            avatar: 'üòä',
            theme: 'purple',
            cart: [],
            orders: [],
            achievements: [],
            currentFilter: 'all',
            isSpecialAdmin: false,
            firstName: '',
            lastName: '',
            deliveredBooks: []
        };
        
        // Global orders storage
        let globalOrders = [];
        
        // Global delivered books storage
        let globalDeliveredBooks = [];

        const themes = {
            purple: { p: '#667eea', s: '#764ba2' },
            blue: { p: '#4facfe', s: '#00f2fe' },
            pink: { p: '#f093fb', s: '#f5576c' },
            green: { p: '#43e97b', s: '#38f9d7' },
            orange: { p: '#fa709a', s: '#fee140' },
            teal: { p: '#30cfd0', s: '#330867' }
        };

        const achievementsList = [
            { id: 'first_book', icon: 'üìñ', title: 'First Purchase', desc: 'Buy your first book', condition: () => state.orders.length >= 1 },
            { id: 'book_lover', icon: 'üìö', title: 'Book Lover', desc: 'Purchase 5 books', condition: () => state.orders.length >= 5 },
            { id: 'collector', icon: 'üéØ', title: 'Collector', desc: 'Purchase 10 books', condition: () => state.orders.length >= 10 },
            { id: 'digital_fan', icon: 'üíª', title: 'Digital Fan', desc: 'Buy 3 eBooks', condition: () => state.orders.filter(o => o.items && o.items.some(i => i.type === 'ebook')).length >= 3 },
            { id: 'physical_fan', icon: 'üìï', title: 'Physical Fan', desc: 'Buy 3 physical books', condition: () => state.orders.filter(o => o.items && o.items.some(i => i.type === 'physical')).length >= 3 },
            { id: 'explorer', icon: 'üó∫Ô∏è', title: 'Explorer', desc: 'Try both eBooks and physical', condition: () => state.orders.some(o => o.items && o.items.some(i => i.type === 'ebook')) && state.orders.some(o => o.items && o.items.some(i => i.type === 'physical')) },
            { id: 'bestseller_fan', icon: 'üî•', title: 'Bestseller Fan', desc: 'Buy a bestseller book', condition: () => state.orders.some(o => o.items && o.items.some(item => books.find(b => b.title === item.title && b.badge === 'BESTSELLER'))) },
            { id: 'customizer', icon: 'üé®', title: 'Customizer', desc: 'Change your profile settings', condition: () => state.avatar !== 'üòä' || state.theme !== 'purple' }
        ];

        let books = [
            {
                title: "Wacky Whispers",
                ebook: 4,
                physical: 7,
                rating: 4.5,
                sales: 145,
                preview: "Ellie Voss had been banned from three cactus stores in her town. And not for stealing. Not even for poking the cactuses (which, for the record, she only did once. Okay, twice. Maybe four times. Whatever).\n\nShe just had... a reputation.\n\nSo when she walked into \"Cactus Palace: Where Every Prickle Has a Purpose\", the man behind the counter immediately ducked behind a pile of potted succulents.\n\n\"Just looking!\" Ellie called cheerfully. \"No explosions today, I promise!\""
            },
            {
                title: "Life of a Smashkarts Hero",
                ebook: 3,
                physical: 6,
                rating: 4.8,
                sales: 289,
                popular: true,
                preview: "Uggh! Is this how it feels to be in a game! I wish I was back in the customizer.\n\nThe only problem is that, My player won't stop crashing me. It feels soooo good when his friend plays with me. It feels like he can sense something."
            },
            {
                title: "Life of a Ragdoll Hero",
                ebook: 3,
                physical: 6,
                rating: 4.6,
                sales: 178,
                preview: "Ragdoll, a person in the game of stickman clash, was living life. Things were going great for him and his family, until that day.\n\nA huge cyborg named LUKE was wrecking havoc and forcing everyone to the games."
            },
            {
                title: "Adventures of Maple and the Sky Kingdom",
                ebook: 6,
                physical: 9,
                rating: 5.0,
                sales: 412,
                popular: true,
                badge: "BESTSELLER",
                preview: "Maple Thistlewhip was not supposed to be in the attic.\n\nHer mother had said it plainly: \"No climbing that rickety ladder, young lady. There are squirrels up there. Possibly ghosts.\"\n\nBut the wind had whispered her name again. \"Maple...\""
            },
            {
                title: "The Great Sandwich Mystery",
                ebook: 6,
                physical: 9,
                rating: 4.7,
                sales: 234,
                preview: "Timmy the raccoon opened his lunchbox with ultimate excitement.\n\nInside should have been the tallest, stickiest, most perfect peanut butter and jelly sandwich in the whole forest.\n\nNow there was nothing left but a sad, soggy lettuce leaf."
            },
            {
                title: "Puppet Hockey Hero",
                ebook: 4,
                physical: 7,
                rating: 4.4,
                sales: 167,
                preview: "It was the last day of Puppet School, it was the day we were graduating.\n\nI got a score of 97/100 which was amazing with the skills I had."
            },
            {
                title: "Silent Echoes",
                ebook: 4,
                physical: 7,
                rating: 4.9,
                sales: 198,
                preview: "The small town of Haven's End had never encountered anything remotely like the vast, shimmering dome that now stretched impossibly over the edge of the ancient forest.\n\nTwelve-year-old Lila Granger stood pressed against her bedroom window, staring wide-eyed at the strange phenomenon."
            }
        ];

        // Load saved state
        function loadState() {
            const saved = localStorage.getItem('randomParkBooks');
            if (saved) {
                const loaded = JSON.parse(saved);
                state = { ...state, ...loaded };
            }
            
            const savedBooks = localStorage.getItem('randomParkBooks_books');
            if (savedBooks) {
                books = JSON.parse(savedBooks);
            }
            
            const savedGlobalOrders = localStorage.getItem('randomParkBooks_globalOrders');
            if (savedGlobalOrders) {
                globalOrders = JSON.parse(savedGlobalOrders);
            }
            
            const savedGlobalDeliveredBooks = localStorage.getItem('randomParkBooks_globalDeliveredBooks');
            if (savedGlobalDeliveredBooks) {
                globalDeliveredBooks = JSON.parse(savedGlobalDeliveredBooks);
            }
        }

        // Save state
        function saveState() {
            localStorage.setItem('randomParkBooks', JSON.stringify(state));
            localStorage.setItem('randomParkBooks_books', JSON.stringify(books));
            localStorage.setItem('randomParkBooks_globalOrders', JSON.stringify(globalOrders));
            localStorage.setItem('randomParkBooks_globalDeliveredBooks', JSON.stringify(globalDeliveredBooks));
        }

        // Welcome Screen Functions
        function selectAvatar(btn, emoji) {
            document.querySelectorAll('.welcome-box .avatar-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            state.avatar = emoji;
        }

        function selectColor(btn, color) {
            document.querySelectorAll('.welcome-box .color-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            state.theme = color;
        }

        function startApp() {
            const firstName = document.getElementById('firstName').value.trim();
            const lastName = document.getElementById('lastName').value.trim();
            
            if (!firstName || !lastName) {
                showNotification('‚ùå Please enter your first and last name!');
                return;
            }
            
            if (!isAuthorizedUser(firstName, lastName)) {
                showNotification('‚ùå You are not authorized to access this store!');
                return;
            }
            
            // Check if trying to login as Unown S
            if (isSpecialAdmin(firstName, lastName)) {
                // Require admin password for Unown S
                const password = prompt('üîê Admin password required for Unown S:');
                if (password !== ADMIN_PASSWORD) {
                    showNotification('‚ùå Incorrect admin password!');
                    return;
                }
            }
            
            // Check if user is already logged in
            if (isUserLoggedIn(firstName, lastName)) {
                showNotification('‚ùå This user is already logged in! Only one session allowed per user.');
                return;
            }
            
            state.name = `${firstName} ${lastName}`;
            state.email = firstName.toLowerCase() + '.' + lastName.toLowerCase() + '@randomparkbooks.com';
            state.isSpecialAdmin = isSpecialAdmin(firstName, lastName);
            state.firstName = firstName;
            state.lastName = lastName;
            
            // Add to logged in users
            addLoggedInUser(firstName, lastName);
            
            document.getElementById('welcomeScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            document.getElementById('displayName').textContent = state.name;
            document.getElementById('userAvatar').textContent = state.avatar;
            
            applyTheme();
            renderBooks();
            updateDisplay();
            saveState();
            
            if (state.isSpecialAdmin) {
                showNotification('üëë Welcome, Unown S! You can view all customer orders.');
            }
        }

        function logout() {
            if (!confirm('Are you sure you want to logout?')) return;
            
            // Remove user from logged in list
            if (state.firstName && state.lastName) {
                removeLoggedInUser(state.firstName, state.lastName);
            }
            
            // Close profile modal first
            closeProfile();
            
            // Clear all state
            localStorage.removeItem('randomParkBooks');
            state = {
                name: '',
                email: '',
                avatar: 'üòä',
                theme: 'purple',
                cart: [],
                orders: [],
                achievements: [],
                currentFilter: 'all',
                isSpecialAdmin: false,
                firstName: '',
                lastName: '',
                deliveredBooks: []
            };
            
            // Reset form
            document.getElementById('firstName').value = '';
            document.getElementById('lastName').value = '';
            
            // Show welcome screen
            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('welcomeScreen').style.display = 'flex';
            
            showNotification('üëã Logged out successfully!');
        }

        function applyTheme() {
            const t = themes[state.theme];
            document.body.style.background = `linear-gradient(135deg, ${t.p} 0%, ${t.s} 100%)`;
            
            const existingStyle = document.getElementById('themeStyle');
            if (existingStyle) existingStyle.remove();
            
            const style = document.createElement('style');
            style.id = 'themeStyle';
            style.innerHTML = `
                .logo { background: linear-gradient(135deg, ${t.p} 0%, ${t.s} 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
                .stat-box { background: linear-gradient(135deg, ${t.p} 0%, ${t.s} 100%); }
                .banner { background: linear-gradient(135deg, ${t.p} 0%, ${t.s} 100%); }
                .filter-btn { border-color: ${t.p}; color: ${t.p}; }
                .filter-btn.active { background: ${t.p}; }
                .search-box:focus { border-color: ${t.p}; box-shadow: 0 0 0 3px ${t.p}33; }
                .book-card::before { background: linear-gradient(135deg, ${t.p} 0%, ${t.s} 100%); }
                .price-option { background: linear-gradient(135deg, ${t.p} 0%, ${t.s} 100%); }
                .add-ebook { background: linear-gradient(135deg, ${t.p} 0%, ${t.s} 100%); }
                .preview-btn { border-color: ${t.p}; color: ${t.p}; }
                .preview-btn:hover { background: ${t.p}; }
                .cart h3 { color: ${t.p}; }
                .notification { background: linear-gradient(135deg, ${t.p} 0%, ${t.s} 100%); }
                .admin-tab { border-color: ${t.p}; color: ${t.p}; }
                .admin-tab.active { background: ${t.p}; }
            `;
            document.head.appendChild(style);
        }

        // Book Functions
        function renderBooks() {
            const search = document.getElementById('searchBox').value.toLowerCase();
            const filtered = books.filter(book => {
                const matchSearch = book.title.toLowerCase().includes(search);
                if (!matchSearch) return false;
                
                if (state.currentFilter === 'all') return true;
                if (state.currentFilter === 'popular') return book.popular;
                if (state.currentFilter === 'ebook') return true;
                if (state.currentFilter === 'physical') return true;
                
                return true;
            });

            document.getElementById('booksGrid').innerHTML = filtered.map((book, i) => {
                const stars = '‚≠ê'.repeat(Math.floor(book.rating));
                const half = book.rating % 1 >= 0.5 ? '‚≠ê' : '';
                
                return `
                    <div class="book-card ${book.badge ? 'featured' : ''}">
                        <div class="book-rating">${stars}${half} (${book.rating})</div>
                        <div class="book-title">
                            ${book.title}
                            ${book.badge ? `<span class="badge">${book.badge}</span>` : ''}
                        </div>
                        <div class="book-meta">
                            <span>üì¶ ${book.sales} sold</span>
                            ${book.popular ? '<span style="color: #f5576c;">üî• Trending</span>' : ''}
                        </div>
                        <div class="book-prices">
                            <div class="price-option">
                                <div class="price-label">eBook</div>
                                <div class="price-value">${book.ebook}</div>
                            </div>
                            <div class="price-option">
                                <div class="price-label">Physical</div>
                                <div class="price-value">${book.physical}</div>
                            </div>
                        </div>
                        <div class="buy-buttons">
                            <button class="buy-btn add-ebook" onclick="addToCart(${i}, 'ebook')">
                                üõí Add eBook
                            </button>
                            <button class="buy-btn add-physical" onclick="addToCart(${i}, 'physical')">
                                üõí Add Physical
                            </button>
                        </div>
                        <button class="preview-btn" onclick="showPreview(${i})">
                            üëÅÔ∏è Read Preview
                        </button>
                    </div>
                `;
            }).join('');
        }

        function addToCart(index, type) {
            const book = books[index];
            const price = type === 'ebook' ? book.ebook : book.physical;
            
            state.cart.push({
                title: book.title,
                type: type,
                price: price
            });
            
            showNotification(`‚úÖ Added "${book.title}" (${type}) to cart!`);
            updateDisplay();
            saveState();
        }

        function removeFromCart(index) {
            state.cart.splice(index, 1);
            updateDisplay();
            saveState();
            showNotification('üóëÔ∏è Item removed from cart');
        }

        function showPreview(index) {
            const book = books[index];
            document.getElementById('previewTitle').textContent = book.title;
            document.getElementById('previewText').textContent = book.preview;
            document.getElementById('previewModal').style.display = 'block';
        }

        function closePreview() {
            document.getElementById('previewModal').style.display = 'none';
        }

        function setFilter(filter) {
            state.currentFilter = filter;
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            renderBooks();
        }

        function filterBooks() {
            renderBooks();
        }

        function updateDisplay() {
            // Update cart
            const cartDiv = document.getElementById('cartItems');
            if (state.cart.length === 0) {
                cartDiv.innerHTML = '<p style="color: #999;">Your cart is empty. Add some books!</p>';
                document.getElementById('checkoutBtn').disabled = true;
            } else {
                cartDiv.innerHTML = state.cart.map((item, index) => `
                    <div class="cart-item">
                        <div>
                            <strong>${item.title}</strong><br>
                            <small style="color: #666;">${item.type} ‚Ä¢ ${item.price}</small>
                        </div>
                        <button class="remove-item" onclick="removeFromCart(${index})">Remove</button>
                    </div>
                `).join('');
                document.getElementById('checkoutBtn').disabled = false;
            }
            
            // Update summary
            document.getElementById('totalItems').textContent = state.cart.length;
            document.getElementById('ebookCount').textContent = state.cart.filter(i => i.type === 'ebook').length;
            document.getElementById('physicalCount').textContent = state.cart.filter(i => i.type === 'physical').length;
            
            // Update achievements
            updateAchievements();
        }

        function updateAchievements() {
            const unlocked = achievementsList.filter(a => a.condition()).map(a => a.id);
            state.achievements = unlocked;
            document.getElementById('achievementCount').textContent = unlocked.length;
            document.getElementById('totalAchievements').textContent = achievementsList.length;
        }

        // Checkout
        function proceedToCheckout() {
            if (state.cart.length === 0) return;
            
            document.getElementById('checkoutName').value = state.name;
            document.getElementById('checkoutEmail').value = state.email;
            
            const summary = state.cart.map(item => 
                `<div style="padding: 8px 0; border-bottom: 1px solid #ddd;">
                    <strong>${item.title}</strong> (${item.type}) - ${item.price}
                </div>`
            ).join('');
            
            const total = state.cart.reduce((sum, item) => sum + item.price, 0);
            
            document.getElementById('checkoutSummary').innerHTML = summary + 
                `<div style="padding: 12px 0; font-weight: bold; font-size: 18px;">
                    Total: ${total}
                </div>`;
            
            document.getElementById('checkoutModal').style.display = 'block';
        }

        function confirmOrder() {
            const notes = document.getElementById('checkoutNotes').value;
            
            // Create order
            const order = {
                id: Date.now(),
                name: state.name,
                email: state.email,
                items: [...state.cart],
                notes: notes,
                date: new Date().toLocaleString(),
                total: state.cart.reduce((sum, item) => sum + item.price, 0)
            };
            
            state.orders.push(order);
            
            // Add to global orders for Unown S to view
            globalOrders.push(order);
            
            // Move cart items to orders
            state.cart.forEach(item => {
                const book = books.find(b => b.title === item.title);
                if (book) book.sales++;
            });
            
            // Clear cart
            state.cart = [];
            
            saveState();
            closeCheckout();
            
            showNotification('‚úÖ Order confirmed! Check your email for confirmation.');
            
            // Simulate email (in real app, this would be sent to backend)
            console.log('Order Email:', order);
            
            updateDisplay();
            renderBooks();
        }

        function closeCheckout() {
            document.getElementById('checkoutModal').style.display = 'none';
        }

        // Profile Functions
        function showProfile() {
            document.getElementById('profileName').value = state.name;
            
            // Show appropriate orders based on user type
            const ordersToShow = state.isSpecialAdmin ? globalOrders : state.orders;
            
            if (state.isSpecialAdmin) {
                document.getElementById('ordersHeader').textContent = 'üëë All Customer Orders';
                document.getElementById('profilePurchases').textContent = globalOrders.length;
            } else {
                document.getElementById('ordersHeader').textContent = 'üì¶ Your Orders';
                document.getElementById('profilePurchases').textContent = state.orders.length;
            }
            
            const ordersList = document.getElementById('profileOrdersList');
            
            if (ordersToShow.length === 0) {
                ordersList.innerHTML = '<p style="color: #999; padding: 20px; text-align: center;">No orders yet.</p>';
            } else {
                ordersList.innerHTML = ordersToShow.slice().reverse().map(order => `
                    <div class="admin-book-item" style="margin-top: 15px;">
                        <div>
                            <h4>Order #${order.id}</h4>
                            ${state.isSpecialAdmin ? `<p style="color: #f5576c; margin: 5px 0; font-weight: bold;">
                                üë§ Customer: ${order.name} (${order.email})
                            </p>` : ''}
                            <p style="color: #666; margin: 5px 0;">
                                <strong>Date:</strong> ${order.date}
                            </p>
                            <p style="color: #666; margin: 5px 0;">
                                <strong>Total:</strong> ${order.total}
                            </p>
                            <p style="color: #666; margin: 5px 0;">
                                <strong>Items:</strong>
                            </p>
                            <ul style="margin-left: 20px; color: #666;">
                                ${order.items.map(item => `<li>${item.title} (${item.type}) - ${item.price}</li>`).join('')}
                            </ul>
                            ${order.notes ? `<p style="color: #999; margin: 5px 0; font-style: italic;"><strong>Notes:</strong> ${order.notes}</p>` : ''}
                        </div>
                    </div>
                `).join('');
            }
            
            // Highlight current avatar
            document.querySelectorAll('#profileModal .avatar-btn').forEach(btn => {
                btn.classList.remove('selected');
                if (btn.textContent === state.avatar) {
                    btn.classList.add('selected');
                }
            });
            
            // Highlight current theme
            const themeColors = {
                purple: 0, blue: 1, pink: 2, green: 3, orange: 4, teal: 5
            };
            document.querySelectorAll('#profileModal .color-btn').forEach((btn, i) => {
                btn.classList.remove('selected');
                if (i === themeColors[state.theme]) {
                    btn.classList.add('selected');
                }
            });
            
            document.getElementById('profileModal').style.display = 'block';
        }

        function closeProfile() {
            document.getElementById('profileModal').style.display = 'none';
        }

        function updateProfile() {
            state.name = document.getElementById('profileName').value;
            document.getElementById('displayName').textContent = state.name;
            saveState();
            showNotification('‚úÖ Profile updated!');
        }

        function updateAvatar(btn, emoji) {
            document.querySelectorAll('#profileModal .avatar-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            state.avatar = emoji;
            document.getElementById('userAvatar').textContent = emoji;
            saveState();
            showNotification('‚úÖ Avatar updated!');
            updateAchievements();
        }

        function updateTheme(btn, theme) {
            document.querySelectorAll('#profileModal .color-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            state.theme = theme;
            applyTheme();
            saveState();
            showNotification('‚úÖ Theme updated!');
            updateAchievements();
        }

        // Achievements
        function showAchievements() {
            const list = document.getElementById('achievementsList');
            list.innerHTML = achievementsList.map(achievement => {
                const unlocked = state.achievements.includes(achievement.id);
                return `
                    <div class="achievement ${unlocked ? 'unlocked' : ''}">
                        <div class="achievement-icon">${achievement.icon}</div>
                        <div class="achievement-title">${achievement.title}</div>
                        <div class="achievement-desc">${achievement.desc}</div>
                        ${unlocked ? '<div style="margin-top: 10px; font-weight: bold;">‚úÖ Unlocked</div>' : '<div style="margin-top: 10px; opacity: 0.5;">üîí Locked</div>'}
                    </div>
                `;
            }).join('');
            
            document.getElementById('achievementsModal').style.display = 'block';
        }

        function closeAchievements() {
            document.getElementById('achievementsModal').style.display = 'none';
        }

        // Admin Functions
        function openAdminLogin() {
            document.getElementById('adminPassword').value = '';
            document.getElementById('adminLoginModal').style.display = 'block';
        }

        function closeAdminLogin() {
            document.getElementById('adminLoginModal').style.display = 'none';
        }

        function checkAdminPassword() {
            const password = document.getElementById('adminPassword').value;
            
            if (password === ADMIN_PASSWORD) {
                closeAdminLogin();
                openAdminPanel();
                showNotification('‚úÖ Welcome, Admin!');
            } else {
                showNotification('‚ùå Incorrect password!');
                setTimeout(() => {
                    closeAdminLogin();
                }, 2000);
            }
        }

        function openAdminPanel() {
            loadAdminBooks();
            loadAdminOrders();
            populateBookDropdown();
            document.getElementById('adminPanel').style.display = 'block';
        }

        function closeAdminPanel() {
            document.getElementById('adminPanel').style.display = 'none';
        }

        function showAdminTab(tab) {
            document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            document.querySelectorAll('.admin-section').forEach(s => s.classList.remove('active'));
            
            if (tab === 'books') {
                document.getElementById('adminBooksSection').classList.add('active');
                loadAdminBooks();
            } else if (tab === 'add') {
                document.getElementById('adminAddSection').classList.add('active');
            } else if (tab === 'orders') {
                document.getElementById('adminOrdersSection').classList.add('active');
                loadAdminOrders();
                populateBookDropdown();
            }
        }
        
        function populateBookDropdown() {
            const select = document.getElementById('deliverBookSelect');
            select.innerHTML = '<option value="">-- Choose a book --</option>' + 
                books.map((book, index) => `<option value="${index}">${book.title}</option>`).join('');
        }
        
        function deliverBookToCustomer() {
            const customerName = document.getElementById('deliverCustomerName').value.trim();
            const bookIndex = document.getElementById('deliverBookSelect').value;
            
            if (!customerName) {
                showNotification('‚ùå Please enter a customer name!');
                return;
            }
            
            if (bookIndex === '') {
                showNotification('‚ùå Please select a book!');
                return;
            }
            
            const book = books[parseInt(bookIndex)];
            
            // Create delivered book record
            const deliveredBook = {
                id: Date.now(),
                customerName: customerName,
                bookTitle: book.title,
                bookContent: book.preview,
                date: new Date().toLocaleString()
            };
            
            globalDeliveredBooks.push(deliveredBook);
            saveState();
            
            // Clear form
            document.getElementById('deliverCustomerName').value = '';
            document.getElementById('deliverBookSelect').value = '';
            
            showNotification(`‚úÖ "${book.title}" delivered to ${customerName}!`);
        }
        
        function readBook(bookTitle) {
            const book = books.find(b => b.title === bookTitle);
            if (!book) {
                showNotification('‚ùå Book not found!');
                return;
            }
            
            document.getElementById('readerBookTitle').textContent = book.title;
            document.getElementById('readerBookContent').textContent = book.preview;
            document.getElementById('bookReaderModal').style.display = 'block';
        }
        
        function closeBookReader() {
            document.getElementById('bookReaderModal').style.display = 'none';
        }

        function loadAdminBooks() {
            const list = document.getElementById('adminBooksList');
            list.innerHTML = books.map((book, index) => `
                <div class="admin-book-item">
                    <div>
                        <h4>${book.title} ${book.badge ? `<span class="badge">${book.badge}</span>` : ''}</h4>
                        <p style="color: #666; margin: 5px 0;">
                            eBook: ${book.ebook} | Physical: ${book.physical} | 
                            Rating: ${book.rating}‚≠ê | Sales: ${book.sales}
                        </p>
                        <p style="color: #999; font-size: 13px; margin-top: 5px;">
                            ${book.popular ? 'üî• Popular' : ''}
                        </p>
                    </div>
                    <div class="admin-actions">
                        <button class="admin-btn admin-btn-edit" onclick="editBook(${index})">‚úèÔ∏è Edit</button>
                        <button class="admin-btn admin-btn-delete" onclick="deleteBook(${index})">üóëÔ∏è Delete</button>
                    </div>
                </div>
            `).join('');
        }

        function addNewBook() {
            const title = document.getElementById('newBookTitle').value.trim();
            const ebook = parseFloat(document.getElementById('newBookEbook').value);
            const physical = parseFloat(document.getElementById('newBookPhysical').value);
            const rating = parseFloat(document.getElementById('newBookRating').value);
            const sales = parseInt(document.getElementById('newBookSales').value);
            const badge = document.getElementById('newBookBadge').value.trim();
            const popular = document.getElementById('newBookPopular').checked;
            const preview = document.getElementById('newBookPreview').value.trim();
            
            if (!title || !preview) {
                showNotification('‚ùå Please fill in title and preview!');
                return;
            }
            
            books.push({
                title,
                ebook,
                physical,
                rating,
                sales,
                badge: badge || undefined,
                popular,
                preview
            });
            
            saveState();
            renderBooks();
            showNotification('‚úÖ Book added successfully!');
            
            // Clear form
            document.getElementById('newBookTitle').value = '';
            document.getElementById('newBookEbook').value = '5';
            document.getElementById('newBookPhysical').value = '10';
            document.getElementById('newBookRating').value = '4.5';
            document.getElementById('newBookSales').value = '0';
            document.getElementById('newBookBadge').value = '';
            document.getElementById('newBookPopular').checked = false;
            document.getElementById('newBookPreview').value = '';
        }

        function editBook(index) {
            const book = books[index];
            
            document.getElementById('newBookTitle').value = book.title;
            document.getElementById('newBookEbook').value = book.ebook;
            document.getElementById('newBookPhysical').value = book.physical;
            document.getElementById('newBookRating').value = book.rating;
            document.getElementById('newBookSales').value = book.sales;
            document.getElementById('newBookBadge').value = book.badge || '';
            document.getElementById('newBookPopular').checked = book.popular || false;
            document.getElementById('newBookPreview').value = book.preview;
            
            // Delete old book
            books.splice(index, 1);
            saveState();
            loadAdminBooks();
            
            showAdminTab('add');
            const addTab = document.querySelectorAll('.admin-tab')[1];
            addTab.click();
            
            showNotification('‚úèÔ∏è Edit mode - Update and click Add Book');
        }

        function deleteBook(index) {
            if (!confirm('Are you sure you want to delete this book?')) return;
            
            books.splice(index, 1);
            saveState();
            renderBooks();
            loadAdminBooks();
            showNotification('üóëÔ∏è Book deleted successfully!');
        }

        function loadAdminOrders() {
            const list = document.getElementById('adminOrdersList');
            
            if (globalOrders.length === 0) {
                list.innerHTML = '<p style="color: #999;">No orders yet.</p>';
                return;
            }
            
            list.innerHTML = globalOrders.slice().reverse().map(order => `
                <div class="admin-book-item">
                    <div>
                        <h4>Order #${order.id}</h4>
                        <p style="color: #666; margin: 5px 0;">
                            <strong>Customer:</strong> ${order.name} (${order.email})
                        </p>
                        <p style="color: #666; margin: 5px 0;">
                            <strong>Date:</strong> ${order.date}
                        </p>
                        <p style="color: #666; margin: 5px 0;">
                            <strong>Total:</strong> ${order.total}
                        </p>
                        <p style="color: #666; margin: 5px 0;">
                            <strong>Items:</strong>
                        </p>
                        <ul style="margin-left: 20px; color: #666;">
                            ${order.items.map(item => `<li>${item.title} (${item.type}) - ${item.price}</li>`).join('')}
                        </ul>
                        ${order.notes ? `<p style="color: #999; margin: 5px 0; font-style: italic;"><strong>Notes:</strong> ${order.notes}</p>` : ''}
                    </div>
                </div>
            `).join('');
        }

        // Modal Functions
        function closeModal(event, id) {
            if (event.target.id === id) {
                document.getElementById(id).style.display = 'none';
            }
        }

        function showNotification(msg) {
            const notif = document.getElementById('notification');
            notif.textContent = msg;
            notif.style.display = 'block';
            setTimeout(() => {
                notif.style.display = 'none';
            }, 3500);
        }

        // Initialize
        window.onload = function() {
            loadState();
            
            // If user is logged in, skip welcome screen
            if (state.name && state.email) {
                document.getElementById('welcomeScreen').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                document.getElementById('displayName').textContent = state.name;
                document.getElementById('userAvatar').textContent = state.avatar;
                applyTheme();
                renderBooks();
                updateDisplay();
            }
        };
    </script>
</body>
</html>
