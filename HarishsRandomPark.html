<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Random Park Books - Buy Books with Tickets</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        header {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        .logo {
            font-size: 32px;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .header-right {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        .stats-panel {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .stat-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 10px 15px;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .ticket-counter {
            display: flex;
            align-items: center;
            gap: 10px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            padding: 12px 24px;
            border-radius: 25px;
            color: white;
            font-weight: bold;
            font-size: 18px;
            box-shadow: 0 4px 15px rgba(245, 87, 108, 0.4);
            cursor: pointer;
            transition: all 0.3s;
        }
        .ticket-counter:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(245, 87, 108, 0.6);
        }
        .customize-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        .customize-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
            display: none;
        }
        .dashboard-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        .dashboard-card h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 16px;
        }
        .dashboard-value {
            font-size: 32px;
            font-weight: bold;
            color: #333;
        }
        .progress-bar {
            width: 100%;
            height: 10px;
            background: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
            margin-top: 10px;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: width 0.5s ease;
        }
        .banner {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            padding: 20px;
            border-radius: 15px;
            color: white;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        .filters-section {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        .filters {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }
        .filter-btn {
            padding: 10px 20px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        .filter-btn.active {
            background: #667eea;
            color: white;
        }
        .search-box {
            padding: 10px 15px;
            border: 2px solid #ddd;
            border-radius: 20px;
            font-size: 14px;
            flex: 1;
            min-width: 200px;
        }
        .books-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        .book-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
            position: relative;
        }
        .book-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.2);
        }
        .book-card.discounted::before {
            content: '🔥 HOT DEAL';
            position: absolute;
            top: -10px;
            right: 10px;
            background: #f5576c;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: bold;
        }
        .book-rating {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
        }
        .book-title {
            font-size: 20px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            line-height: 1.4;
        }
        .book-meta {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            font-size: 12px;
            color: #666;
        }
        .book-prices {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        .price-option {
            flex: 1;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
        }
        .price-label {
            font-size: 12px;
            opacity: 0.9;
            margin-bottom: 5px;
        }
        .price-value {
            font-size: 18px;
        }
        .buy-buttons {
            display: flex;
            gap: 10px;
        }
        .buy-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }
        .buy-ebook {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .buy-physical {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }
        .buy-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        .buy-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        .preview-btn {
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        .preview-btn:hover {
            background: #667eea;
            color: white;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            overflow-y: auto;
        }
        .modal-content {
            background: white;
            max-width: 700px;
            margin: 50px auto;
            padding: 40px;
            border-radius: 15px;
            position: relative;
        }
        .close-btn {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 30px;
            cursor: pointer;
            color: #666;
        }
        .close-btn:hover {
            color: #000;
        }
        .preview-text {
            line-height: 1.8;
            color: #333;
            white-space: pre-wrap;
        }
        .cart-section {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        .cart {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        .cart h3 {
            color: #667eea;
            margin-bottom: 15px;
        }
        .cart-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background: #f8f9fa;
            margin-bottom: 10px;
            border-radius: 8px;
        }
        .cart-summary {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        .checkout-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s;
        }
        .checkout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(67, 233, 123, 0.4);
        }
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            z-index: 2000;
            display: none;
            animation: slideIn 0.3s;
        }
        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        .badge {
            background: #f5576c;
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            margin-left: 8px;
        }
        .welcome-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            z-index: 3000;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .welcome-box {
            background: white;
            padding: 50px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 450px;
            width: 90%;
            text-align: center;
        }
        .welcome-box h1 {
            color: #667eea;
            margin-bottom: 30px;
            font-size: 32px;
        }
        .welcome-box input {
            width: 100%;
            padding: 15px;
            margin-bottom: 20px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            transition: border 0.3s;
        }
        .welcome-box input:focus {
            outline: none;
            border-color: #667eea;
        }
        .start-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s;
        }
        .start-btn:hover {
            transform: scale(1.05);
        }
        .start-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        .welcome-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }
        .customize-section {
            margin-top: 25px;
            padding-top: 25px;
            border-top: 2px solid #eee;
        }
        .customize-section h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 18px;
        }
        .customize-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 3000;
            overflow-y: auto;
        }
        .customize-modal-content {
            background: white;
            max-width: 600px;
            margin: 50px auto;
            padding: 40px;
            border-radius: 20px;
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }
        .customize-modal-content h2 {
            color: #667eea;
            margin-bottom: 30px;
            text-align: center;
        }
        .color-options {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }
        .color-btn {
            width: 100%;
            height: 50px;
            border: 3px solid transparent;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .color-btn:hover {
            transform: scale(1.1);
        }
        .color-btn.selected {
            border-color: #333;
            box-shadow: 0 0 0 2px white, 0 0 0 4px #333;
        }
        .avatar-options {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        .avatar-btn {
            font-size: 35px;
            padding: 8px;
            border: 3px solid transparent;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s;
            background: #f8f9fa;
        }
        .avatar-btn:hover {
            transform: scale(1.2);
        }
        .avatar-btn.selected {
            border-color: #667eea;
            background: #e8eaf6;
        }
        .avatar-btn.locked {
            opacity: 0.3;
            cursor: not-allowed;
            position: relative;
        }
        .avatar-btn.locked::after {
            content: '🔒';
            position: absolute;
            bottom: -5px;
            right: -5px;
            font-size: 16px;
        }
        .unlock-badge {
            display: inline-block;
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            color: #333;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            margin-left: 5px;
        }
        .tier-section {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        .tier-title {
            font-size: 13px;
            color: #666;
            margin-bottom: 10px;
            font-weight: bold;
        }
        .tier-unlocked {
            color: #43e97b;
        }
        .tier-locked {
            color: #999;
        }
        .profile-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 3000;
            overflow-y: auto;
        }
        .profile-modal-content {
            background: white;
            max-width: 800px;
            margin: 50px auto;
            padding: 40px;
            border-radius: 20px;
            position: relative;
        }
        .profile-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #eee;
        }
        .profile-avatar {
            font-size: 80px;
            margin-bottom: 15px;
        }
        .profile-name {
            font-size: 28px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        .profile-level {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 16px;
        }
        .profile-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .profile-stat-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
        }
        .profile-stat-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }
        .profile-stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }
        .profile-stat-label {
            font-size: 14px;
            color: #666;
        }
        .profile-section {
            margin-bottom: 30px;
        }
        .profile-section h3 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 22px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .profile-achievements {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
        }
        .profile-achievement {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            transition: all 0.3s;
        }
        .profile-achievement.unlocked {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            transform: scale(1.05);
        }
        .profile-achievement.locked {
            opacity: 0.4;
        }
        .profile-achievement-icon {
            font-size: 35px;
            margin-bottom: 8px;
        }
        .profile-achievement-name {
            font-size: 11px;
            font-weight: bold;
        }
        .profile-progress-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
        }
        .profile-progress-item {
            margin-bottom: 15px;
        }
        .profile-progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: bold;
            color: #333;
        }
        .profile-progress-bar {
            width: 100%;
            height: 12px;
            background: #e0e0e0;
            border-radius: 6px;
            overflow: hidden;
        }
        .profile-progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: width 0.5s ease;
        }
        .achievements {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            display: none;
        }
        .achievements h3 {
            color: #667eea;
            margin-bottom: 20px;
        }
        .achievement-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
        }
        .achievement {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            transition: all 0.3s;
        }
        .achievement.unlocked {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }
        .achievement.locked {
            opacity: 0.4;
        }
        .achievement-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }
        .achievement-name {
            font-size: 12px;
            font-weight: bold;
        }
        @media (max-width: 768px) {
            .cart-section {
                grid-template-columns: 1fr;
            }
            .dashboard {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div id="welcomeScreen" class="welcome-screen">
        <div class="welcome-box">
            <div class="welcome-icon">📚</div>
            <h1>Welcome to Random Park Books!</h1>
            <input type="text" id="userName" placeholder="Enter your name" />
            <input type="number" id="userTickets" placeholder="How many tickets do you have?" min="0" />
            
            <div class="customize-section">
                <h3>Choose Your Avatar</h3>
                <div class="avatar-options">
                    <button class="avatar-btn selected" onclick="selectAvatar('😊')">😊</button>
                    <button class="avatar-btn" onclick="selectAvatar('😃')">😃</button>
                    <button class="avatar-btn" onclick="selectAvatar('🙂')">🙂</button>
                    <button class="avatar-btn" onclick="selectAvatar('😄')">😄</button>
                    <button class="avatar-btn" onclick="selectAvatar('😁')">😁</button>
                    <button class="avatar-btn" onclick="selectAvatar('😆')">😆</button>
                </div>
            </div>
            <div class="customize-section">
                <h3>Choose Your Theme Color</h3>
                <div class="color-options">
                    <button class="color-btn selected" onclick="selectColor('purple')" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);"></button>
                    <button class="color-btn" onclick="selectColor('blue')" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);"></button>
                    <button class="color-btn" onclick="selectColor('pink')" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);"></button>
                    <button class="color-btn" onclick="selectColor('green')" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);"></button>
                    <button class="color-btn" onclick="selectColor('orange')" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);"></button>
                    <button class="color-btn" onclick="selectColor('teal')" style="background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);"></button>
                    <button class="color-btn" onclick="selectColor('red')" style="background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);"></button>
                    <button class="color-btn" onclick="selectColor('sunset')" style="background: linear-gradient(135deg, #ff6e7f 0%, #bfe9ff 100%);"></button>
                </div>
            </div>
            <button class="start-btn" onclick="startApp()">Start Shopping</button>
        </div>
    </div>
    <div class="container" id="mainApp" style="display: none;">
        <header>
           <div class="logo">
    <img src="logo.png" alt="Logo" style="height: 70px; vertical-align: middle; margin-right: 8px;">
    Random Park Books
</div>

            <div class="header-right">
                <div class="stats-panel">
                    <div class="stat-box">
                        <span>📊</span>
                        <span>Level <span id="userLevel">1</span></span>
                    </div>
                    <div class="stat-box">
                        <span>📚</span>
                        <span><span id="booksBadge">0</span> Books</span>
                    </div>
                    <div class="stat-box">
                        <span>🏆</span>
                        <span><span id="achievementCount">0</span>/15</span>
                    </div>
                </div>
                <button class="customize-btn" onclick="openCustomize()">🎨 Customize</button>
                <div class="ticket-counter" onclick="openProfile()">
                    <span class="ticket-icon">🎫</span>
                    <span id="ticketCount">0</span>
                    <span>Tickets</span>
                    <span style="margin-left: 15px;"><span id="userAvatar">😊</span> <span id="userName"></span></span>
                </div>
            </div>
        </header>
        <div class="dashboard">
            <div class="dashboard-card">
                <h3>💰 Total Spent</h3>
                <div class="dashboard-value"><span id="totalSpent">0</span>T</div>
            </div>
            <div class="dashboard-card">
                <h3>💎 Total Saved</h3>
                <div class="dashboard-value"><span id="totalSaved">0</span>T</div>
            </div>
            <div class="dashboard-card">
                <h3>📖 Ebooks Owned</h3>
                <div class="dashboard-value" id="ebooksOwned">0</div>
            </div>
            <div class="dashboard-card">
                <h3>📚 Physical Books</h3>
                <div class="dashboard-value" id="physicalOwned">0</div>
            </div>
            <div class="dashboard-card">
                <h3>⚡ Next Level</h3>
                <div class="dashboard-value" style="font-size: 20px;"><span id="booksToNextLevel">5</span> books</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="levelProgress" style="width: 0%;"></div>
                </div>
            </div>
        </div>
        <div class="banner">
            <h2>🎉 National Coffee Day Special! 🎉</h2>
            <p>Get 1 Ticket on any Ebook purchase! • Most Popular: Adventures of Maple and the Sky Kingdom 🔥</p>
        </div>
        <div class="achievements">
            <h3>🏆 Achievements</h3>
            <div class="achievement-grid" id="achievementsGrid"></div>
        </div>
        <div class="filters-section">
            <div class="filters">
                <input type="text" class="search-box" id="searchBox" placeholder="🔍 Search books..." oninput="filterBooks()">
                <button class="filter-btn active" onclick="setFilter('all')">All Books</button>
                <button class="filter-btn" onclick="setFilter('ebook')">Ebooks Only</button>
                <button class="filter-btn" onclick="setFilter('physical')">Physical Only</button>
                <button class="filter-btn" onclick="setFilter('cheap')">Under 5T</button>
                <button class="filter-btn" onclick="setFilter('popular')">Popular</button>
            </div>
        </div>
        <div class="books-grid" id="booksGrid"></div>
        <div class="cart-section">
            <div class="cart">
                <h3>🛒 Purchase History</h3>
                <div id="cartItems"></div>
            </div>
            <div class="cart-summary">
                <h3>📊 Statistics</h3>
                <div class="summary-row">
                    <span>Total Purchases:</span>
                    <span id="totalPurchases">0</span>
                </div>
                <div class="summary-row">
                    <span>Tickets Spent:</span>
                    <span id="ticketsSpent">0</span>
                </div>
                <div class="summary-row">
                    <span>Tickets Earned:</span>
                    <span id="ticketsEarned">0</span>
                </div>
                <div class="summary-row">
                    <span>Favorite Type:</span>
                    <span id="favoriteType">-</span>
                </div>
                <button class="checkout-btn" onclick="showStats()">📈 View Detailed Stats</button>
            </div>
        </div>
    </div>
    <div id="previewModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closePreview()">&times;</span>
            <h2 id="previewTitle" style="color: #667eea; margin-bottom: 20px;"></h2>
            <div id="previewText" class="preview-text"></div>
        </div>
    </div>
    <div id="notification" class="notification"></div>
    <div id="customizeModal" class="customize-modal">
        <div class="customize-modal-content">
            <span class="close-btn" onclick="closeCustomize()">&times;</span>
            <h2>🎨 Customize Your Experience</h2>
            
            <div class="customize-section">
                <h3>Choose Your Avatar <span style="font-size: 14px; color: #999;">(Buy more books to unlock!)</span></h3>
                <div id="avatarTiersContainer"></div>
            </div>
            <div class="customize-section">
                <h3>Choose Your Theme Color</h3>
                <div class="color-options" id="colorOptions">
                    <button class="color-btn" onclick="selectColorMain('purple')" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);"></button>
                    <button class="color-btn" onclick="selectColorMain('blue')" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);"></button>
                    <button class="color-btn" onclick="selectColorMain('pink')" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);"></button>
                    <button class="color-btn" onclick="selectColorMain('green')" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);"></button>
                    <button class="color-btn" onclick="selectColorMain('orange')" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);"></button>
                    <button class="color-btn" onclick="selectColorMain('teal')" style="background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);"></button>
                    <button class="color-btn" onclick="selectColorMain('red')" style="background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);"></button>
                    <button class="color-btn" onclick="selectColorMain('sunset')" style="background: linear-gradient(135deg, #ff6e7f 0%, #bfe9ff 100%);"></button>
                </div>
            </div>
            <button class="start-btn" onclick="closeCustomize()">Save Changes</button>
        </div>
    </div>
    <div id="profileModal" class="profile-modal">
        <div class="profile-modal-content">
            <span class="close-btn" onclick="closeProfile()">&times;</span>
            
            <div class="profile-header">
                <div class="profile-avatar" id="profileAvatar">😊</div>
                <div class="profile-name" id="profileName">User</div>
                <div class="profile-level">Level <span id="profileLevel">1</span></div>
            </div>
            <div class="profile-stats-grid">
                <div class="profile-stat-card">
                    <div class="profile-stat-icon">🎫</div>
                    <div class="profile-stat-value" id="profileTickets">0</div>
                    <div class="profile-stat-label">Tickets</div>
                </div>
                <div class="profile-stat-card">
                    <div class="profile-stat-icon">📚</div>
                    <div class="profile-stat-value" id="profileBooks">0</div>
                    <div class="profile-stat-label">Books Owned</div>
                </div>
                <div class="profile-stat-card">
                    <div class="profile-stat-icon">💰</div>
                    <div class="profile-stat-value" id="profileSpent">0</div>
                    <div class="profile-stat-label">Total Spent</div>
                </div>
                <div class="profile-stat-card">
                    <div class="profile-stat-icon">💎</div>
                    <div class="profile-stat-value" id="profileSaved">0</div>
                    <div class="profile-stat-label">Total Saved</div>
                </div>
            </div>
            <div class="profile-section">
                <h3>📖 Reading Stats</h3>
                <div class="profile-stats-grid">
                    <div class="profile-stat-card">
                        <div class="profile-stat-icon">📱</div>
                        <div class="profile-stat-value" id="profileEbooks">0</div>
                        <div class="profile-stat-label">Ebooks</div>
                    </div>
                    <div class="profile-stat-card">
                        <div class="profile-stat-icon">📖</div>
                        <div class="profile-stat-value" id="profilePhysical">0</div>
                        <div class="profile-stat-label">Physical Books</div>
                    </div>
                    <div class="profile-stat-card">
                        <div class="profile-stat-icon">🎟️</div>
                        <div class="profile-stat-value" id="profileEarned">0</div>
                        <div class="profile-stat-label">Tickets Earned</div>
                    </div>
                    <div class="profile-stat-card">
                        <div class="profile-stat-icon">❤️</div>
                        <div class="profile-stat-value" id="profileFavorite">-</div>
                        <div class="profile-stat-label">Favorite Type</div>
                    </div>
                </div>
            </div>
            <div class="profile-section">
                <h3>🏆 Achievements (<span id="profileAchievementCount">0</span>/15)</h3>
                <div class="profile-achievements" id="profileAchievements"></div>
            </div>
            <div class="profile-section">
                <h3>📊 Progress to Next Level</h3>
                <div class="profile-progress-section">
                    <div class="profile-progress-item">
                        <div class="profile-progress-label">
                            <span>Level Progress</span>
                            <span><span id="profileLevelProgress">0</span>/5 books</span>
                        </div>
                        <div class="profile-progress-bar">
                            <div class="profile-progress-fill" id="profileLevelBar" style="width: 0%;"></div>
                        </div>
                    </div>
                    <div class="profile-progress-item">
                        <div class="profile-progress-label">
                            <span>Avatar Unlocks</span>
                            <span><span id="profileAvatarUnlocked">6</span>/54 avatars</span>
                        </div>
                        <div class="profile-progress-bar">
                            <div class="profile-progress-fill" id="profileAvatarBar" style="width: 11%;"></div>
                        </div>
                    </div>
                    <div class="profile-progress-item">
                        <div class="profile-progress-label">
                            <span>Collection Completion</span>
                            <span><span id="profileCollectionPercent">0</span>%</span>
                        </div>
                        <div class="profile-progress-bar">
                            <div class="profile-progress-fill" id="profileCollectionBar" style="width: 0%;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        let tickets = 0;
        let userName = '';
        let userAvatar = '😊';
        let userColor = 'purple';
        let booksPurchased = 0;
        let totalSpent = 0;
        let totalSaved = 0;
        let ticketsEarned = 0;
        let ebooksOwned = 0;
        let physicalOwned = 0;
        let currentFilter = 'all';
        const cart = [];
        const purchaseHistory = [];
        const colorThemes = {
            purple: { primary: '#667eea', secondary: '#764ba2' },
            blue: { primary: '#4facfe', secondary: '#00f2fe' },
            pink: { primary: '#f093fb', secondary: '#f5576c' },
            green: { primary: '#43e97b', secondary: '#38f9d7' },
            orange: { primary: '#fa709a', secondary: '#fee140' },
            teal: { primary: '#30cfd0', secondary: '#330867' },
            red: { primary: '#eb3349', secondary: '#f45c43' },
            sunset: { primary: '#ff6e7f', secondary: '#bfe9ff' }
        };
        const avatarTiers = {
            0: ['😊', '😃', '🙂', '😄', '😁', '😆'],
            3: ['🦊', '🐼', '🐨', '🐯', '🐰', '🐻'],
            5: ['🦁', '🐸', '🦉', '🦄', '🐲', '🦅'],
            8: ['🌟', '⭐', '✨', '💫', '🌠', '🔥'],
            12: ['👑', '💎', '🏆', '🎖️', '🥇', '👾'],
            15: ['🚀', '🛸', '🌈', '🎭', '🎪', '🎨'],
            20: ['🦸', '🧙', '🧚', '🦹', '🧝', '🧞'],
            25: ['💀', '👻', '🤖', '👽', '🎃', '🦇'],
            30: ['🐉', '🦖', '🦕', '🐙', '🦑', '🦈']
        };
        const achievements = [
            { id: 'first', icon: '🎉', name: 'First Purchase', condition: () => booksPurchased >= 1 },
            { id: 'collector', icon: '📚', name: 'Book Collector', condition: () => booksPurchased >= 5 },
            { id: 'library', icon: '🏛️', name: 'Personal Library', condition: () => booksPurchased >= 10 },
            { id: 'ebook', icon: '📱', name: 'Digital Fan', condition: () => ebooksOwned >= 3 },
            { id: 'physical', icon: '📖', name: 'Traditional Reader', condition: () => physicalOwned >= 3 },
            { id: 'saver', icon: '💰', name: 'Smart Shopper', condition: () => totalSaved >= 10 },
            { id: 'spender', icon: '💸', name: 'Big Spender', condition: () => totalSpent >= 50 },
            { id: 'level5', icon: '⭐', name: 'Level 5 Master', condition: () => getUserLevel() >= 5 },
            { id: 'all', icon: '🌟', name: 'Complete Collection', condition: () => booksPurchased >= books.length },
            { id: 'earner', icon: '🎫', name: 'Ticket Earner', condition: () => ticketsEarned >= 20 },
            { id: 'maple', icon: '🦊', name: 'Maple Fan', condition: () => purchaseHistory.some(p => p.title.includes('Maple')) },
            { id: 'smash', icon: '🎮', name: 'Gamer Reader', condition: () => purchaseHistory.some(p => p.title.includes('Smashkarts')) },
            { id: 'mystery', icon: '🔍', name: 'Mystery Solver', condition: () => purchaseHistory.some(p => p.title.includes('Mystery')) },
            { id: 'diverse', icon: '🎨', name: 'Diverse Taste', condition: () => ebooksOwned >= 2 && physicalOwned >= 2 },
            { id: 'ultimate', icon: '👑', name: 'Ultimate Reader', condition: () => booksPurchased >= 20 }
        ];
        const books = [
            {
                title: "Wacky Whispers",
                ebookPrice: 4,
                physicalPrice: 7,
                rating: 4.5,
                purchases: 145,
                preview: `Ellie Voss had been banned from three cactus stores in her town. And not for stealing. Not even for poking the cactuses (which, for the record, she only did once. Okay, twice. Maybe four times. Whatever).
She just had... a reputation.
So when she walked into "Cactus Palace: Where Every Prickle Has a Purpose", the man behind the counter immediately ducked behind a pile of potted succulents.
"Just looking!" Ellie called cheerfully. "No explosions today, I promise!"
She strolled past a tall cactus named Spikey McNeedleface, a squat one called Sir Pokington III, and a weirdly fuzzy one with a sign that read:
❗ DO NOT PET ME. I AM NOT A CAT ❗
The soft voice whispered: "Bubble gum explosion… at 2:17... bring cheese."
"Either I'm losing my mind," she muttered, "or these cactuses are trying to send me on a snack-based mission."`
            },
            {
                title: "Life of a Smashkarts Hero",
                ebookPrice: 3,
                physicalPrice: 6,
                rating: 4.8,
                purchases: 289,
                popular: true,
                preview: `Uggh! Is this how it feels to be in a game! I wish I was back in the customizer.
The only problem is that, My player won't stop crashing me. It feels soooo good when his friend plays with me. It feels like he can sense something.
We all went into games because of a problem. A big one.`
            },
            {
                title: "Life of a Ragdoll Hero",
                ebookPrice: 3,
                physicalPrice: 6,
                rating: 4.6,
                purchases: 178,
                preview: `Ragdoll, a person in the game of stickman clash, was living life. Things were going great for him and his family, until that day.
A huge cyborg named LUKE was wrecking havoc and forcing everyone to the games. He was going to take over all of the games in the entire universe.
Ragdoll couldn't bear watching all of their strongest warriors fight for them in a such a way that they were losing.`
            },
            {
                title: "Adventures of Maple and the Sky Kingdom",
                ebookPrice: 6,
                physicalPrice: 9,
                rating: 5.0,
                purchases: 412,
                popular: true,
                badge: "BESTSELLER",
                preview: `Maple Thistlewhip was not supposed to be in the attic.
Her mother had said it plainly: "No climbing that rickety ladder, young lady. There are squirrels up there. Possibly ghosts."
But the wind had whispered her name again. "Maple..."
She found a strange umbrella — bright blue with silver embroidery of stars and moons. A note was pinned to the handle:
"For the journey above. Hold on tight."
Before Maple could blink, a gust of wind burst through the attic, and the umbrella yanked itself open — dragging her right out of the window and into the sky.
She screamed — mostly in excitement.`
            },
            {
                title: "The Great Sandwich Mystery",
                ebookPrice: 6,
                physicalPrice: 9,
                rating: 4.7,
                purchases: 234,
                preview: `Timmy the raccoon opened his lunchbox with ultimate excitement.
Inside should have been the tallest, stickiest, most perfect peanut butter and jelly sandwich in the whole forest.
Now there was nothing left but a sad, soggy lettuce leaf.
Timmy gasped with a noise so loud, a flock of geese changed direction mid-air.
"This," he squeaked, "is a THIEVERY of epic proportions!"
Barry the bear cub strolled by with an apple and frowned. "You're overreacting."
Timmy snarled, "Overreacting is the only proper reaction when sandwiches are murdered!"`
            },
            {
                title: "Puppet Hockey Hero",
                ebookPrice: 4,
                physicalPrice: 7,
                rating: 4.4,
                purchases: 167,
                preview: `It was the last day of Puppet School, it was the day we were graduating.
I got a score of 97/100 which was amazing with the skills I had. Then after we had the graduation ceremony we got to choose our teams or the country that we would fight for and pour every single atom of energy that we had.
I chose Team India.`
            },
            {
                title: "Silent Echoes",
                ebookPrice: 4,
                physicalPrice: 7,
                rating: 4.9,
                purchases: 198,
                preview: `The small town of Haven's End had never encountered anything remotely like the vast, shimmering dome that now stretched impossibly over the edge of the ancient forest.
Twelve-year-old Lila Granger stood pressed against her bedroom window, staring wide-eyed at the strange phenomenon. Her grandfather had vanished into those woods several years ago, leaving behind only enigmatic notes and a tattered compass.
Armed only with her grandfather's ancient journal and a flickering flashlight, she slipped quietly through the back door. Ready or not, she was stepping into the unknown, determined to find answers that might save her family—and the fate of the entire town.`
            }
        ];
        function getUserLevel() {
            return Math.floor(booksPurchased / 5) + 1;
        }
        function getUnlockedAvatars() {
            const unlocked = [];
            for (const [tier, emojis] of Object.entries(avatarTiers)) {
                if (booksPurchased >= parseInt(tier)) {
                    unlocked.push(...emojis);
                }
            }
            return unlocked;
        }
        function renderAvatarTiers() {
            const container = document.getElementById('avatarTiersContainer');
            const unlockedAvatars = getUnlockedAvatars();
            
            let html = '';
            for (const [tier, emojis] of Object.entries(avatarTiers)) {
                const tierNum = parseInt(tier);
                const isUnlocked = booksPurchased >= tierNum;
                const tierNames = {
                    0: 'Starter Pack',
                    3: 'Animal Friends',
                    5: 'Mythical Creatures',
                    8: 'Cosmic Powers',
                    12: 'Legendary Icons',
                    15: 'Adventure Time',
                    20: 'Super Heroes',
                    25: 'Spooky Squad',
                    30: 'Ancient Beasts'
                };
                
                html += `
                    <div class="tier-section">
                        <div class="tier-title ${isUnlocked ? 'tier-unlocked' : 'tier-locked'}">
                            ${isUnlocked ? '✅' : '🔒'} ${tierNames[tierNum]} ${!isUnlocked ? `(Unlock at ${tierNum} books)` : ''}
                        </div>
                        <div class="avatar-options">
                            ${emojis.map(emoji => `
                                <button class="avatar-btn ${!isUnlocked ? 'locked' : ''} ${userAvatar === emoji ? 'selected' : ''}" 
                                        onclick="selectAvatarMain('${emoji}')" 
                                        ${!isUnlocked ? 'disabled' : ''}>
                                    ${emoji}
                                </button>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }
        function renderAchievements() {
            const container = document.getElementById('achievementsGrid');
            let unlockedCount = 0;
            
            container.innerHTML = achievements.map(ach => {
                const unlocked = ach.condition();
                if (unlocked) unlockedCount++;
                
                return `
                    <div class="achievement ${unlocked ? 'unlocked' : 'locked'}">
                        <div class="achievement-icon">${ach.icon}</div>
                        <div class="achievement-name">${ach.name}</div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('achievementCount').textContent = unlockedCount;
        }
        function selectAvatar(emoji) {
            userAvatar = emoji;
            document.querySelectorAll('.welcome-box .avatar-btn').forEach(btn => {
                btn.classList.remove('selected');
                if (btn.textContent === emoji) {
                    btn.classList.add('selected');
                }
            });
        }
        function selectColor(color) {
            userColor = color;
            document.querySelectorAll('.welcome-box .color-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            event.target.classList.add('selected');
        }
        function selectAvatarMain(emoji) {
            const unlockedAvatars = getUnlockedAvatars();
            if (!unlockedAvatars.includes(emoji)) {
                showNotification('🔒 This avatar is locked! Buy more books to unlock it.');
                return;
            }
            
            userAvatar = emoji;
            document.getElementById('userAvatar').textContent = emoji;
            renderAvatarTiers();
            showNotification(`Avatar changed to ${emoji}`);
        }
        function selectColorMain(color) {
            userColor = color;
            document.querySelectorAll('#colorOptions .color-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            event.target.classList.add('selected');
            applyTheme();
            showNotification(`Theme changed to ${color}!`);
        }
        function openCustomize() {
            document.getElementById('customizeModal').style.display = 'block';
            renderAvatarTiers();
            
            document.querySelectorAll('#colorOptions .color-btn').forEach((btn, index) => {
                const colors = ['purple', 'blue', 'pink', 'green', 'orange', 'teal', 'red', 'sunset'];
                btn.classList.remove('selected');
                if (colors[index] === userColor) {
                    btn.classList.add('selected');
                }
            });
        }
        function closeCustomize() {
            document.getElementById('customizeModal').style.display = 'none';
        }
        function openProfile() {
            document.getElementById('profileModal').style.display = 'block';
            updateProfileModal();
        }
        function closeProfile() {
            document.getElementById('profileModal').style.display = 'none';
        }
        function updateProfileModal() {
            document.getElementById('profileAvatar').textContent = userAvatar;
            document.getElementById('profileName').textContent = userName;
            document.getElementById('profileLevel').textContent = getUserLevel();
            document.getElementById('profileTickets').textContent = tickets;
            document.getElementById('profileBooks').textContent = booksPurchased;
            document.getElementById('profileSpent').textContent = totalSpent + 'T';
            document.getElementById('profileSaved').textContent = totalSaved + 'T';
            document.getElementById('profileEbooks').textContent = ebooksOwned;
            document.getElementById('profilePhysical').textContent = physicalOwned;
            document.getElementById('profileEarned').textContent = ticketsEarned;
            
            if (ebooksOwned > physicalOwned) {
                document.getElementById('profileFavorite').textContent = 'Ebook';
            } else if (physicalOwned > ebooksOwned) {
                document.getElementById('profileFavorite').textContent = 'Physical';
            } else if (ebooksOwned > 0) {
                document.getElementById('profileFavorite').textContent = 'Mixed';
            } else {
                document.getElementById('profileFavorite').textContent = '-';
            }
            
            const achievementsContainer = document.getElementById('profileAchievements');
            let unlockedCount = 0;
            
            achievementsContainer.innerHTML = achievements.map(ach => {
                const unlocked = ach.condition();
                if (unlocked) unlockedCount++;
                
                return `
                    <div class="profile-achievement ${unlocked ? 'unlocked' : 'locked'}">
                        <div class="profile-achievement-icon">${ach.icon}</div>
                        <div class="profile-achievement-name">${ach.name}</div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('profileAchievementCount').textContent = unlockedCount;
            
            const levelProgress = booksPurchased % 5;
            document.getElementById('profileLevelProgress').textContent = levelProgress;
            document.getElementById('profileLevelBar').style.width = (levelProgress / 5 * 100) + '%';
            
            const unlockedAvatars = getUnlockedAvatars().length;
            document.getElementById('profileAvatarUnlocked').textContent = unlockedAvatars;
            document.getElementById('profileAvatarBar').style.width = (unlockedAvatars / 54 * 100) + '%';
            
            const collectionPercent = Math.round((booksPurchased / books.length) * 100);
            document.getElementById('profileCollectionPercent').textContent = collectionPercent;
            document.getElementById('profileCollectionBar').style.width = collectionPercent + '%';
        }
        function applyTheme() {
            const theme = colorThemes[userColor];
            document.body.style.background = `linear-gradient(135deg, ${theme.primary} 0%, ${theme.secondary} 100%)`;
            
            const existingStyle = document.getElementById('themeStyle');
            if (existingStyle) existingStyle.remove();
            
            const style = document.createElement('style');
            style.id = 'themeStyle';
            style.innerHTML = `
                .logo { background: linear-gradient(135deg, ${theme.primary} 0%, ${theme.secondary} 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
                .stat-box { background: linear-gradient(135deg, ${theme.primary} 0%, ${theme.secondary} 100%); }
                .customize-btn { background: linear-gradient(135deg, ${theme.primary} 0%, ${theme.secondary} 100%); }
                .banner { background: linear-gradient(135deg, ${theme.primary} 0%, ${theme.secondary} 100%); }
                .dashboard-card h3 { color: ${theme.primary}; }
                .progress-fill { background: linear-gradient(135deg, ${theme.primary} 0%, ${theme.secondary} 100%); }
                .achievements h3 { color: ${theme.primary}; }
                .filter-btn { border-color: ${theme.primary}; color: ${theme.primary}; }
                .filter-btn.active { background: ${theme.primary}; }
                .price-option { background: linear-gradient(135deg, ${theme.primary} 0%, ${theme.secondary} 100%); }
                .buy-ebook { background: linear-gradient(135deg, ${theme.primary} 0%, ${theme.secondary} 100%); }
                .preview-btn { border-color: ${theme.primary}; color: ${theme.primary}; }
                .preview-btn:hover { background: ${theme.primary}; }
                .cart h3 { color: ${theme.primary}; }
                .cart-summary h3 { color: ${theme.primary}; }
                .notification { background: linear-gradient(135deg, ${theme.primary} 0%, ${theme.secondary} 100%); }
                #previewTitle { color: ${theme.primary}; }
                .customize-modal-content h2 { color: ${theme.primary}; }
                .customize-section h3 { color: ${theme.primary}; }
                .avatar-btn.selected { border-color: ${theme.primary}; }
            `;
            document.head.appendChild(style);
        }
        function startApp() {
            const nameInput = document.getElementById('userName');
            const ticketsInput = document.getElementById('userTickets');
            
            if (!nameInput.value.trim()) {
                alert('Please enter your name!');
                return;
            }
            
            if (!ticketsInput.value || ticketsInput.value < 0) {
                alert('Please enter a valid number of tickets!');
                return;
            }
            
            userName = nameInput.value.trim();
            tickets = parseInt(ticketsInput.value);
            
            document.getElementById('welcomeScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            document.querySelectorAll('#userName').forEach(el => el.textContent = userName);
            document.getElementById('userAvatar').textContent = userAvatar;
            
            applyTheme();
            renderBooks();
            renderAchievements();
            updateDisplay();
        }
        function renderBooks() {
            const grid = document.getElementById('booksGrid');
            const searchTerm = document.getElementById('searchBox').value.toLowerCase();
            
            let filteredBooks = books.filter(book => {
                const matchesSearch = book.title.toLowerCase().includes(searchTerm);
                
                if (!matchesSearch) return false;
                
                if (currentFilter === 'all') return true;
                if (currentFilter === 'popular') return book.popular;
                if (currentFilter === 'cheap') return book.ebookPrice < 5;
                if (currentFilter === 'ebook') return true;
                if (currentFilter === 'physical') return true;
                
                return true;
            });
            
            grid.innerHTML = filteredBooks.map((book, index) => {
                const stars = '⭐'.repeat(Math.floor(book.rating)) + (book.rating % 1 >= 0.5 ? '½' : '');
                
                return `
                <div class="book-card ${book.badge ? 'discounted' : ''}">
                    ${book.badge ? '' : ''}
                    <div class="book-rating">${stars} (${book.rating})</div>
                    <div class="book-title">
                        ${book.title}
                        ${book.badge ? `<span class="badge">${book.badge}</span>` : ''}
                    </div>
                    <div class="book-meta">
                        <span>📦 ${book.purchases} sold</span>
                        ${book.popular ? '<span style="color: #f5576c;">🔥 Trending</span>' : ''}
                    </div>
                    <div class="book-prices">
                        <div class="price-option">
                            <div class="price-label">Ebook</div>
                            <div class="price-value">${book.ebookPrice}T</div>
                        </div>
                        <div class="price-option">
                            <div class="price-label">Physical</div>
                            <div class="price-value">${book.physicalPrice}T</div>
                        </div>
                    </div>
                    <div class="buy-buttons">
                        <button class="buy-btn buy-ebook" onclick="buyBook(${books.indexOf(book)}, 'ebook')">
                            Buy Ebook
                        </button>
                        <button class="buy-btn buy-physical" onclick="buyBook(${books.indexOf(book)}, 'physical')">
                            Buy Physical
                        </button>
                    </div>
                    <button class="preview-btn" onclick="showPreview(${books.indexOf(book)})">
                        📖 Read Preview
                    </button>
                </div>
            `;
            }).join('');
        }
        function buyBook(index, type) {
            const book = books[index];
            const price = type === 'ebook' ? book.ebookPrice : book.physicalPrice;
            
            if (tickets >= price) {
                const oldLevel = getUserLevel();
                const previousUnlocked = getUnlockedAvatars().length;
                
                tickets -= price;
                booksPurchased++;
                totalSpent += price;
                
                if (type === 'ebook') {
                    tickets += 1;
                    ticketsEarned += 1;
                    ebooksOwned++;
                    totalSaved += 1;
                    showNotification(`✅ Purchased ${book.title} (Ebook) for ${price}T! +1 Bonus Ticket!`);
                } else {
                    physicalOwned++;
                    showNotification(`✅ Purchased ${book.title} (Physical) for ${price}T!`);
                }
                
                const purchase = {
                    title: book.title,
                    type: type,
                    price: price,
                    timestamp: new Date().toLocaleString()
                };
                
                cart.push(purchase);
                purchaseHistory.push(purchase);
                
                updateDisplay();
                renderAchievements();
                
                const newUnlocked = getUnlockedAvatars().length;
                if (newUnlocked > previousUnlocked) {
                    setTimeout(() => {
                        showNotification(`🎉 New avatars unlocked! Check the customize menu!`);
                    }, 1500);
                }
                
                const newLevel = getUserLevel();
                if (newLevel > oldLevel) {
                    setTimeout(() => {
                        showNotification(`🎊 Level Up! You're now level ${newLevel}!`);
                    }, 2000);
                }
            } else {
                showNotification(`❌ Not enough tickets! You need ${price}T but only have ${tickets}T`);
            }
        }
        function updateDisplay() {
            document.getElementById('ticketCount').textContent = tickets;
            document.getElementById('booksBadge').textContent = booksPurchased;
            document.getElementById('userLevel').textContent = getUserLevel();
            document.getElementById('totalSpent').textContent = totalSpent;
            document.getElementById('totalSaved').textContent = totalSaved;
            document.getElementById('ebooksOwned').textContent = ebooksOwned;
            document.getElementById('physicalOwned').textContent = physicalOwned;
            
            const nextLevelBooks = (getUserLevel() * 5) - booksPurchased;
            document.getElementById('booksToNextLevel').textContent = nextLevelBooks;
            
            const progressPercent = ((booksPurchased % 5) / 5) * 100;
            document.getElementById('levelProgress').style.width = progressPercent + '%';
            
            const cartItems = document.getElementById('cartItems');
            if (cart.length === 0) {
                cartItems.innerHTML = '<p style="color: #999;">No purchases yet</p>';
            } else {
                cartItems.innerHTML = cart.slice().reverse().map(item => `
                    <div class="cart-item">
                        <div>
                            <strong>${item.title}</strong><br>
                            <small style="color: #666;">${item.type} • ${item.timestamp}</small>
                        </div>
                        <span style="font-weight: bold;">${item.price}T</span>
                    </div>
                `).join('');
            }
            
            document.getElementById('totalPurchases').textContent = booksPurchased;
            document.getElementById('ticketsSpent').textContent = totalSpent;
            document.getElementById('ticketsEarned').textContent = ticketsEarned;
            
            if (ebooksOwned > physicalOwned) {
                document.getElementById('favoriteType').textContent = 'Ebook';
            } else if (physicalOwned > ebooksOwned) {
                document.getElementById('favoriteType').textContent = 'Physical';
            } else if (ebooksOwned > 0) {
                document.getElementById('favoriteType').textContent = 'Mixed';
            } else {
                document.getElementById('favoriteType').textContent = '-';
            }
        }
        function showPreview(index) {
            const book = books[index];
            document.getElementById('previewTitle').textContent = book.title;
            document.getElementById('previewText').textContent = book.preview;
            document.getElementById('previewModal').style.display = 'block';
        }
        function closePreview() {
            document.getElementById('previewModal').style.display = 'none';
        }
        function showNotification(message) {
            const notif = document.getElementById('notification');
            notif.textContent = message;
            notif.style.display = 'block';
            setTimeout(() => {
                notif.style.display = 'none';
            }, 3000);
        }
        function setFilter(filter) {
            currentFilter = filter;
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            renderBooks();
        }
        function filterBooks() {
            renderBooks();
        }
        function showStats() {
            const stats = `
📊 Detailed Statistics
Total Books Purchased: ${booksPurchased}
Current Level: ${getUserLevel()}
Ebooks Owned: ${ebooksOwned}
Physical Books Owned: ${physicalOwned}
💰 Financial Stats:
Total Spent: ${totalSpent}T
Total Saved: ${totalSaved}T
Tickets Earned: ${ticketsEarned}T
Net Spending: ${totalSpent - ticketsEarned}T
🏆 Achievement Progress:
Unlocked: ${document.getElementById('achievementCount').textContent}
🎨 Customization:
Unlocked Avatars: ${getUnlockedAvatars().length}
Current Theme: ${userColor}
            `;
            alert(stats);
        }
        window.onclick = function(event) {
            const previewModal = document.getElementById('previewModal');
            const customizeModal = document.getElementById('customizeModal');
            const profileModal = document.getElementById('profileModal');
            if (event.target === previewModal) {
                closePreview();
            }
            if (event.target === customizeModal) {
                closeCustomize();
            }
            if (event.target === profileModal) {
                closeProfile();
            }
        }
    </script>
</body>
</html>

